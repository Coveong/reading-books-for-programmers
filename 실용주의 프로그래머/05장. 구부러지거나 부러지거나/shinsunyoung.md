# 5장. 구부러지거나 부러지거나

# 26. 결합도 줄이기와 디미터 법칙

코드를 세포(모듈)로 구성하고, 이들 간의 상호작용을 제한하라. 그러면 한 모듈이 변경되거나 교체된다 하더라도 다른 모듈들은 변경 없이 수행될 수 있을 것이다.

## 결합도 줄이기

의존이 많아질수록 시스템 어딘가의 무관한 변화가 코드에 영향을 미칠 수 있는 위험이 커진다. 필요한 정보는 직접 물어보자.

의존관계가 많다는 징후

1. 한 모듈의 '간단한' 수정이 이와 관계없는 모듈들을 통해 시스템 전역에 퍼져나가는 경우
2. 개발자가 수정한 부분이 시스템에 어떤 영향을 미칠지 몰라 코드의 수정을 두려워하는 경우

불필요한 의존이 많은 시스템은 유지보수가 어렵고, 이로 인해 비용이 많이 들며 시스템 자체가 불안전해지는 경향이 있다. 의존도를 최소화하기 위해 디미터 법칙을 사용하여 메서드, 함수를 설계한다.

## 디미터 함수 법칙

> Tip 36.
모듈간의 결합도를 최소화하라.

## 확실히 차이를 낳는가?

디미터 법칙은 코드를 더 적응성 있고 강하게 만들어 주지만, 주계약자가 존재하기 때문에 모든 하부 계약자를 직접 관리하고, 위임해주어야 한다.

→ 즉, 위임자에게 단순히 요청만 전달하는 역할만 하는 메서드를 많이 만들게 되는데, 성능 저하, 메모리 과부하를 문제를 야기할 수도 있다.

상황에 따라 잘 판단해서 결정하자!

# 27. 메타 프로그래밍

세부사항을 코드에서 몰아내라

## 동적 설정

시스템을 되도록 설정가능하게 만들자. 배경 색, 텍스트 이런 것 뿐만 아니라 알고리즘의 선택, 데이터베이스, 미들웨어 같은 요소들까지! 

> Tip 37.
통합하지 말고 설정하라.

메타데이터느느 데이터에 관한 데이터이다. 데이터베이스 스키마, 데이터 디렉터리 등이 이에 속한다. 메타데이터는 애플리케이션을 기술하는 데이터를 포함한다. 자바의 properties

## 메타데이터 주도 애플리케이션

가능한 많은 메타데이터를 써서 애플리케이션을 설정하고 실행시켜라.

> Tip 38.
코드에는 추상화를, 메타데이터에는 세부 내용을.

이렇게 접근하면 이점이 몇 가지 존재한다.

- 설계의 결합도를 줄여 더 유연하고 적응성 있는 프로그램을 만들 수 있다.
- 세부사항을 코드 밖으로 몰아냄으로써 보다 강하고 추상적인 디자인을 만들 수 있다.
- 애플리케이션을 커스터마이징하기 위해 다시 컴파일할 필요가 없다.
- 범용 프로그래밍 언어보다는 문제 도메인에 가까운 방식으로 표현될 수 있다.
- 동일한 애플리케이션 엔진과 상이한 메타데이터를 이용해 여러 다른 프로젝트를 진행할 수 있게 된다.

가능한 마지막 순간까지 세부 정의를 피하고, 세부사항을 소프트하게, 변화하기 쉽게 남겨 두라.

## 비즈니스 로직

비즈니스 정책이나 룰은 프로젝트의 다른 어떤 부분보다 변화하기 쉽기 때문에 이를 유연한 포맷을 통해 유지보수하는 것이 좋다.

# 28. 시간적 결합

우리는 동시성을 허용할 필요가 있고, 시간이나 순서에 따른 의존성 결합을 끊는 방법을 생각할 필요가 있다. 그렇게 함으로써 유연성도 얻을 수 있고, 작업흐름 분석, 아키텍처, 설계, 배치와 같은 개발의 여러 측면에서 시간과 관련된 모든 의존성도 줄일 수 있다.

## 작업흐름

사용자들이 작업흐름을 모델화하고 분석하는 작업이 필요하다. 활동 다이어그램을 사용하면 동시에 수행될 수 있지만 아직 그렇지 않은 활동들을 찾아내서 병렬성을 극대화할 수 있다.

> Tip 39.
작업흐름 분석을 통해 동시성을 개선하라.

## 아키텍처

> Tip 40.
서비스를 사용해서 설계하라.

## 동시성을 고려한 설계

> Tip 41.
언제나 동시성을 고려해 설계하라.

# 29. 단지 뷰일 뿐이야

모듈마다 자기만의 책임이 있다. 사실, '잘 정의된 단 하나의 책임만 가지는 것'이라는 말이야말로 모듈에 대한 좋은 정의가 된다.

이벤트(무엇을 알리는 메시지)를 이용하면 어떤 객체의 상태 변화를 이에 관심을 가질 다른 객체들에게 알릴 수 있다. 이렇게 사용하면 객체들 사이의 결합을 최소화할 수 있다.

## 출판/구독

객체가 자기가 필요한 이벤트들만 구독해서 받아보고 필요하지 않은 이벤트들은 받아오지 않도록 해야 한다.

## 모델-뷰-컨트롤러

모델을 표시하는 뷰 그리고 뷰를 관리하는 컨트롤러에서 모델을 분리해 내는 것. 이것이 모델-뷰-컨트롤러 이디엄의 핵심 개념이다.

> Tip 42.
모델에서 뷰를 분리하라.

모델과 뷰/컨트롤러를 분리하면, 적은 비용으로 큰 유연성을 얻게 된다.

## GUI를 넘어서

- 모델
    - 대상 객체를 나타내는 추상 데이터 모델. 모델은 어떤 뷰나 컨트롤러에 대해서도 직접적인 지식을 지니지 않는다.
- 뷰
    - 모델을 해석하는 방법. 뷰는 모델의 변화 그리고 컨트롤러가 보내는 논리적 사건을 구독한다.
- 컨트롤러
    - 뷰를 제어하고 모델에 새로운 데이터를 제공하는 방법. 모델과 뷰 둘 모두에 이벤트를 보낸다.

# 30. 칠판

칠판에 형사들이 한 사건을 두고 토론을 하고 있는다.

- 형사들은 서로의 존재를 알 필요가 없다. 형사들은 칠판을 보며 새로운 정보를 얻고, 자신의 정보를 추가한다.
- 형사들은 저마다 다른 종류의 훈련을 받았거나, 교육을 받았을 것이다. 공통점은 '사건을 해결한다'에 집중하고 있다는 것 밖에 없다.
- 수사 과정에서 여러 형사들이 오며 갈 수 있다.
- 칠판에 사진, 증언, 물리적 증거 등등 무엇을 올리든 상관이 없다.

이 특징들은 객체나 코드 모듈에도 마찬가지로 적용된다.

## 칠판 구현

칠판에 대한 일관성 있는 인터페이스 하나만 있으면 된다는 점이 이런 시스템의 큰 장점이다.