# 4장. 실용주의 편집증



>  완벽한 소프트웨어는 만들 수 없다.



클라이언트와 공급자는 권리와 책임에 대해 동의해야 한다.



## 21. 계약에 의한 설계



#### DBC                                                                                      

프로그램의 정확성을 보장하기 위해 소프트웨어 모듈들의 권리와 책임을 문서화하는데에 초점을 맞춘다.

핵심 : 문서화하고 검증하는 것이 계약에 의한 설계의 핵심



정확한 프로그램이란?

스스로 자신이 하는 읽이라고 주장하는 것보다 많거나 적지도 않게 딱 그만큼만  하는 프로그램





- 선행조건(precondition)
  - 루틴이 호출되기 위해 참이어야 하는 것

- 후행조건(postcondition)
  - 루틴이 자기가 할 것이라고 보장하는 것 
- 클래스 불변식(class invariant)
  - 호출자의 입장에서 볼 때는  이 조건이 언제나 참이라고 클래스 보장한다.



> 계약에 따른 설계를 하라.



#### DBC 구현

장점 : 요구사항과 보증의 문제를 전면으로 내세운 다는 것이다.

고려할 점

- 입력 도메인 범위
- 경계 조건
- 루틴이 전달하는 것
- 루틴이 잔달하지 않는 것



#### DBC와 일찍 멈추기

문제를 찾고 원일을 밝히기 위해서는, 사고가 났을 때 ㅇ리찍 멈추는 것이 유리하다.



#### 불변식의 다른 용도



- 루프 불변식 : 단정문을 이용해 명시적으로 코딩할 수도 이찌만 설계와 문서화 도구로서도 유용
- 의미론적 불변식 : 요구사항에 직접 도출된 것이 아닌 얼마든 바뀔수 있는 것을 혼동하지 말고 영향을 끼치지 않게 해야함



## 22. 죽은 프로그램은 거짓말을 하지 않는다



> 일찍 작동을 멈추게 하라.



#### 망치지 말고 멈추라

문제를발견하게 되면, 일찍 시스템을 멈출수 있다는 이득이 있다.

프로그램을 멈추는 것이 할 수 있는 최선일 때가 많다.



## 23. 단정적인 프로그래밍

> 단정문을 사용해서 불가능한 상황을 예방하라

자기기만 훈련하지 말아라. 특히 코딩할때는

"물론 그게 절대 일어나지 않을꺼야"라는 생각이 든다면 그걸 확인하는 코드를 추가하라.

컴파일 중에 단정 기능이 꺼져 있을 수도 있다는 걸 기억하라.



#### 단정기능을 켜두라

프로그램을 출시할 때 단정 기능을 꺼버리는 것은 , 공중곡에를 하면서 연습으로 한 번 건너봤다고 그물 없이 건너는 것과 비슷하다.

정말 문제가 되는 단정문만 끄도록 하자.



## 24. 언제 예외를 사용할까

> 예외는 예외적인 무제에 사용하라.



예외가 있다는 것은 컨트롤의 이동이 즉각적이고 로컬하지 않다는 것이다.

이런 프로그램은 스파게티 코드, 캡슐화를 깨뜨리고 예외 처리를 통해 루틴과 그 호출자들 사이의 결합도가 높아져 버린다.

#### 에러 처리기는 또 다른 대안이다.

에러처리기는 에러가 감지되었을 떄 호출되는 루틴이다.



## 25. 리소스 사용의 균형

> 시작한 것은 끝내라

리소스를 할당하는 루틴이나 객체가 리소스를 해제하는 책임을 져야 한다.





#### 중첩할당

1. 리소스를 할당한 순서의 반대로 해제하라. 리소스의 참조에 문제가 생겨도 리소스가 고아가 되지 않는다.
2. 코드의 여러 곳에서 동일 리소스 집합을 할당하는 경우 할당 순서를 언제나 같게하라. 교착 가능성이 줄어들 것이다.



### 객체와 예외

객체지향 언어로 프로그래밍을 한다면 리소스를 클래스 안에 캡슐하 하는것이 유용하다고 느낄것이다.

특정 리소스 타입이 필요한 때마다 객체를 생성하고 가비지 컬렉터가 객체를 수거해 가면 클래스로 감싸진 리소스를 해제한다.



### 균형과 예외

#### 자바에서 리소스 사용의 균형

게으른 방식의 자동 객체 삭제를 사용

가비지 컬렉션이 객체를 지우려고 하면 finalize메서드가 호출



### 리소스 사용의 균형을 잡을 수 없는 경우

1. 최상위 구조 자신이 자기 안에 들어있는 하위 구조들의 할당을 해제할 책임이 있다.
2. 최상위 구조에서 그냥 할당이 된다.(구조들이 연결이 끊어져 고아가됨)
3. 최상위 구조는 하나라도 하위 구조를 가지고 있을 경우 자기 할당 해제를 거부한다.

#### 균형을 점검하기

코드속에서 프로그램 논리에 따르자면 자원들이 반드시 이런 상태에 있어야 한다고 말할 지점들이 있을 것이다.래퍼들을 사용해서 점검해라













