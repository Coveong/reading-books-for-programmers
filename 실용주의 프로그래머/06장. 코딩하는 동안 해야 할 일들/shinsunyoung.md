# 6장. 코딩하는 동안 해야 할 일들

# 31장. 우연에 맡기는 프로그래밍

개발자인 우리도 지뢰밭에서 일한다. 우리가 빠지기를 기다리는 함정은 하루에도 몇백 개씩 있다. 우리는 우연에 맡기는 프로그래밍, 곧 행운과 어쩌다 오는 성공에 의존하는 프로그래밍을 하지 말아야 한다. 대신 의도적으로 프로그래밍 해야 한다.

## 프로그래밍을 우연에 맡기면 어떻게 되는가

한정된 테스트를 했을 때에는 코드가 잘 돌아가는 것 처럼 보였지만, 단지 운이 좋았기 때문이다.

## 우연적 구현

다른 사람의 루틴을 호출할 때에도 문서화된 동작에 의존하라. 그럴 수 없다면 추측을 문서로 상세히 남겨라.

## 암묵적인 가정

테스트가 특히 거짓 원인과 우연적인 결과로 가득 찬 영역이다. 가정하지 말라. 증명하라. 확고한 사실에 근거하지 않은 가정은 어떤 프로젝트에서든 재앙의 근원이 된다.

> Tip 44.
우연에 맡기는 프로그래밍을 하지 말라.

## 의도적으로 프로그래밍하기

- 언제나 자기가 지금 무엇을 하거 있는지 알아야 한다.
- 완전하게 이해하지 못한 애플리케이션을 빌드하려 하거나 익숙하지 않은 기술을 사용하려고 시도하지 말라.
- 계획을 세우고 그것을 바탕으로 진행하라.
- 신뢰할 수 있는 것에만 기대고, 우연한 일이나 가정에 의존하지 말라.
- 가정을 문서로 남겨라.
- 코드만 테스트하지 말고 가정도 테스트해야 한다.
- 노력을 기울일 대상의 우선순위를 정하라.
- 과거의 노예가 되지 말라.

# 32. 알고리즘의 속도

## O() 표기법

- O(1) : 상수적 (배열의 원소 접근, 단순 명령문)
- O(lg(n)) : 대수적 (이진 검색) [log2(n)의 줄인 표현]
- O(n) : 선형적 (순차 검색)
- O(nlg(n)) : 선형적보다 좋지 않지만, 그래도 그렇게 많이 나쁘지는 않음 (퀵정렬, 힙정렬의 평균 수행시간)
- O(n2) : 제곱적 (선택 정렬과 삽입 정렬)
- O(n3) : 세제곱적 (두 n*n 행렬의 곱)
- O(Cn) : 지수적 (여행하는 판매원 문제, 집합 분할)

## 실전에서 알고리즘 속도

이중 반복문을 사용하면 O(m*n)이 된다. 숫자가 외부 요인에 따라 달라진다면, 잠시 작업을 먼추고 커다란 수가 들어왔을 경우, 수행시간이나 메모리 소비에 어떤 영향을 미칠지 생각해보는 것이 좋다.

> Tip 45.
여러분 알고리즘의 차수를 추정하라.

어떻게 하면 수행시간을 줄일지도 생각해보자. 현장에서 실제 데이터를 입력 받아 돌아가는 코드의 수행시간만이 정말로 의미있는 수치이다.

> Tip 46.
여러분의 추정을 테스트하라

정확하게 시간 재는게 어렵다면 코드 프로파일러를 사용해서 알고리즘이 돌아갈 때 실행되는 각 단계의 반복 회수를 센 다음, 입력값의 규모를 바꿔 가면서 나오는 값을 그래프로 그린다.

## 최고라고 언제나 최고는 아니다

가장 빠른 알고리즘이 언제나 가장 좋은 알고리즘은 아니다. 성능이 좋지만 디버깅 시간이 오래 걸리 수도 있다. 또한 성급한 최적화를 조심하라. 개선하기 전에 그 알고리즘이 정말 병목인지 다시 한 번 생각해보자.

# 33. 리팩터링

## 리팩터링은 언제 해야 하는가?

- 중복
- 직교성이 좋지 않은 설계
- 유효기간이 끝난 지식
- 성능

> Tip 47.
일찍 리팩터링하고, 자주 리팩터링하라.

## 리팩터링은 어떻게 하는가?

천천히, 신중하게, 조심스럽게 진행해야 한다.

1. 리팩터링과 새로운 기능 추가를 동시에 하지 말라.
2. 리팩터링을 시작하기 전 든든한 테스트 코드가 있는지 확인하고 돌리며 리팩토링해라.
3. 단계를 작게 나누어서 신중하게 작업한다. 그리고 단계가 끝날 때마다 테스트를 돌린다.

모듈에 큰 변화가 있어 이전 모듈과 호환성을 맞출 수 없다면 일부러 빌드를 실패하도록 변화를 주는 기법도 유용하다.

# 34. 테스트하기 쉬운 코드

## 단위 테스트

모듈을 통제(혹은 인위로 만들어진)된 환경에서 철저하게 테스트하고 나면, 더 넓은 환경에서 그 모듈이 어떻게 행동할 것인지 더 감을 잡을 수 있을 것이다.

## 계약을 잘 지키는지 테스트해 보기

테스트는 두 가지 사실을 알랴준다.

1. 코드가 계약을 잘 지키는가?
2. 코드로 표현된 계약의 의미가 우리가 생각한 것과 일치하는가?

> Tip 48.
테스트를 염두에 두고 설계하라.

TDD를 사용하면 코드의 인터페이스가 고정되기 전에 미리 시험해볼 수 있다.

## 단위 테스트 작성하기

단위 테스트는 찾기 편한 곳에 위치하고 있어야 한다. 테스트 코드를 쉽게 접근할 수 있게 해놓는 것은, 앞으로 유지보수할 개발자들에게 두 가지의 가치를 제공해준다.

1. 기능을 사용하는 방법이 담긴 예제
2. 코드 변경 시 회귀 테스트를 구축할 수 있는 수단

> Tip 49.
소프트웨어를 테스트하라. 그렇지 않으면 사용자가 테스트하게 될 것이다.

# 35. 사악한 마법사

자신을 위해 만들어진 코드를 정말로 이해하지 못하는 한, 그는 자기 자신을 속이는 것이다.

> Tip 50.
자신이 이해하지 못하는, 마법사가 만들어 준 코드는 사용하지 말라.