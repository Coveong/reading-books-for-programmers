# 4. 선택된 주제들



## 14. 테스트와 가독성



테스트는 다른('실제') 코드 조각이 수행하는 행위를 검사하는 국한된 코드를 의미한다.



테스트 관점에서 가독성에 초점을 맞추는 것으로 우리는 '테스트 주도 개발 방법'이 말하는 것처럼 실제 코드를 작성하기 전에 테스트 코드를 작서해야 한다는 주장이나 테스트 개발론이 다루는 여타의 철학적 측면은 다루지 않는다.



### 읽거나 유지보수하기 쉽게 테스트를 만들어라

테스트 코드가 읽기 쉬워야 한다는 점은 테스트와 상관없는 실제 코드와 마찬가지로 중요하다.

> 다른 프로그래머가 수정하거나 새로운 테스트를 더하는 걸 쉽게 느낄 수 있게 테스트 코드는 읽기 쉬워야 한다.



테스트 코드가 크고 두려우면 일어나는 일

- 코드를 수정하는 일이 두려워진다. 아니, 우리는 이 코드에 손대고 싶지 않아. 테스트 케이스를 모두 변경하는 일은 너무나 끔찍해!
- 새로운 코드를 작성하면 그에 따르는 새로운 테스트를 작성하지 않는다. 시간이 흐름이 지나면서 더 낮은 비율의 코드가 테스트되며, 따라서 코드에 대한 확신이 줄어들 수밖에 없다.



현재 테스트에서 실패하는지 쉽게 잔단할 수 있어야 하고, 새로운 테스트도 쉽게 덧붙일 수 있어야 한다.



### 테스트를 더 읽기 쉽게 만들기

일반적인 설계원리에 따르면 **덜 중요한 세부 사항은 사용자가 볼 필요 없게 숨겨서 더 중요한 내용이 눈에 잘 띄게 해야 한다.**



#### 최소한의 테스트 구문 만들기

복잡한 테스트 코드를 압축하라.

대부분 테스트는특정한 입력이나 상황에 대해서  매우 단순한 문제로 압축되기 때문에 한 줄로 표현할 수 있다.

테스트 코드를 짧게 만든면 코드를 간다하고 읽기 쉽울뿐만 아니라 새 테스트 케이스 추가가 쉬워진다.



### 읽기 편한 메시지 만들기



#### 좋은 테스트 입력값의 선택

테스트에 알맞은 입력값을 선택하는 기술도 있다. 



> 가능하면 가장 간단한 입력으로 코드를 완전히 검사할 수 있어야 한다.



#### 입력값을 단순화하기

> 필요한 작업을 수행하는 범위에서 가장 명확하고 간단한 테스트 값을 선택하라.



#### 다양한 기능의 테스트

코드를 구석구석 철저하게 수행하려고 하나의 '완벽한'입력을 사용하는 것보다는 작은 테스트를 여러 개 사용하는 방식이 방식이 더 쉽고 효과적이다.



### 테스트 함수에 이름 붙이기

테스트 코드를 읽는 사람이 다음과 같은 사항을 빠르게 파악할 수 있다면 큰 도움이 된다.

- 테스트되는 클래스
- 테스트되는 함수
- 테스트되는 상황이나 버그



### 테스트에 친숙한 개발

잘 정의된 인터페이스, 지나치게 많은 상태나 설정을 요구하지 않고 감추어진 데이터를 포함하지 않는 코드

테스트에 친숙한 설계는 서로 다른 일을 수행하는 부분을 서로 분리된 별도의 부분으로 구상하는, 전체적으로 작 조직된 코드를 자연스럽게 낳는다.



테스트하기 어려운 코드

| 특징                                  | 테스트 문제                                 | 설계 문제                                                    |
| ------------------------------------- | ------------------------------------------- | ------------------------------------------------------------ |
| 전역변수를 사용한다                   | 모든 전역변수를 초기화해야함.               | 어떤 함수가 부수적인 효과를 가지느지 판별하기 어렵다. 함수를 별도로 고려할 수 없다. |
| 코드가 많은 외부 컴포넌트를 사용한다. | 처음에 설정할 일이 너무 많아 작성이 힘들다. | 이러한 외부 시스템 중에 어느 하나가 제대로 작동하지 않으면 프로그램이 실패한다.리팩토링이 어렵다. |
| 코드가 비결정적인 행동을 가진다.      | 테스트가 변덕스럽고 안정적이지 못하다.      | 프로그,램이 경합 조건이나 재생하기 어려운 버그를 가지고 있을 확률이 높다. 현장 발생버그를 잡기 힘들다. |



설계가 가지는 좋은 특징

| 특징                                                  | 테스트 장점                        | 설계 장점                                                    |
| ----------------------------------------------------- | ---------------------------------- | ------------------------------------------------------------ |
| 클래스들이 내부 상태가 적다.                          | 설저이 적고 테스트 작성이 수월하다 | 클래스를 이해하기 간다하다.                                  |
| 클래스/함수가 하나의 일만 한다.                       | 더 적은 테스트 코드가 요구된다.    | 더 작고 간단한 컴포넌트는 더 잘모듈화 되있고, 멀다.          |
| 클래스가 다른 클래스에 의존하지 않는다.               | 각 클래스가 독립적으로 테스트된다. | 시스템이 병렬적으로 개발될 수 있다.  클래스가 쉽게 수정될 수 있고, 나머지부분에 영향을 주지 않으면서 제거 될 수도 있다. |
| 함수들이 간단하고 잘 정의된 인터페이스를 가지고 싶다. | 대상이 잘정의되어 있다.            | 인터페이스가 재사용될 가능성이 높다.                         |



### 요약

각 테스트의 최상위 수준은 최대한 간결해야 한다. 이상적으로는 각 테스트의 입출력이 한 줄의 코드로 설명될 수 있어야 한다.

테스트에 실패하면, 버그를 추적해서 수정하느 데 도움이 될 만한 에러 메시지를 출력해야 한다.

코드의 구석구석을 철저하게 실행하는 가장 간단한 입력을 사용하라.

무엇이 테스트되지 분명하게 드러나도록 테스트 함수에 충분한 설명이 포함된 이름을 부여하라.

