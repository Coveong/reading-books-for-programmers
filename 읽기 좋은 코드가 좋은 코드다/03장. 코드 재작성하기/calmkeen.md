# 3. 코드 재작성하기

### 10. 상관없는 하위문제 추출하기

엔지니어링은 커다란 문제를 작은 문제로 쪼갠 다음, 각각의 문제에 대한 해결책을 구하고 하나의 해결책으로 맞추는 일련의 작업을 하는것인데 이를 코드에 적용하면 코드가 튼튼하며 가독성이 좋아진다.



**큰 흐름과 관계가 적은 하위문제를 적극적으로 발견해서 추출하라는 것의 의미**

1. 주어진 함수나 코드 불럭을 보고 상위수준에서 본 이 코드의 목적은 무엇인가?
2. 코드의 모든 줄에 질문을 던져라. "이 코드는 직접적으로 목적을 위해서 존재하는가?" 혹은 목적을 위해서 필요하긴 하지만 목적 자체와 직접적으로 상관없는 하위문제를 해결하는가?
3. 만약 상당히 원래 목적과 직접적으로 관련되지 않은 하위 문제를 해결하는 코드 분량이 많으면 이를 추출해서 별도 함수로 만든다.



## 순수한 유틸리티 코드



문자열 변경, 파일 읽기 /쓰기와 같이 프로그램이 수행하는 일에는 기본적인 작업을 포괄하는 핵심적인 집합이 있다.

이러한 기본 유틸은 프로그래밍 내장 라이브러리에 있는데 이런 일을 스스로 구현할 때도 있다.

라이브러리에 원하는 함수가 없다면 스스로 작성해 유틸리티 코드 모음을 만들어 놓아라.



### 일반적인 목적의 코드



코드를 추출하면 함수를 호출하는 코드를 간단하게 만들고 다른곳에서도 사용할수 있게 만드는 장점이 있다.

함수를 손쉽게 개선하고 기능을 더하고 가독성을 개선하고 코너케이스를 다루는 일이 쉽게 된다.





### 일반적인 목적을 가진 코드를 많이 만들어라



일반적인 목적을 가진 코드는 프로젝트의 나머지 부분에서 완전히 분리되므로 좋다.

이러한 코드는 개발하고, 테스트하고 이해도 쉽다.

SLQ DB, javascript, html등 여러 라이브러리는 프로젝트에서 완전히 분리되어 있다.

이때문에 코드베이스는 그만큼 작아질수 있는것이다.



### 특정한 프로젝트를 위한 기능



Business객체를 만들어 값을 설정하는 정규적 패턴을 갖는 코드 예

```
business =Buisiness()
businesss.name = request.POST["name"]
businesss.url = "/biz/" + make_url_friednly(business.name)
businesss.data = datattime.dataetime.utnow()
business.save_to_database()

def make_url+friendly(text):
 ...
```

코드의 가독성을 높히는 코드이기도 하다.



### 기존의 인터페이스를 단순화하기

모든 사람은 라이브러리가 깔끔하고 설정을 요구하지 않으며 간편한 인터페이스를 좋아한다.

이상적이지 않은 인터페이스를 받아들일 이유는 없다.

이러한 인터페이스는 이를 둘러싸는 함수(wrapper)로 지저분한 내부를 감출 수 있다.



### 지나치게 추출하기



대부분 프로그래머는 충분히 적극적이지 않지만 간혹 너무 흥분해 지나치게 나아가는 경우도 있다.

```
ex)
def url_safe_encrypt(obj):
	...
def url_encrypt_str(data):
	...
def encrypt(data):
	return base64.url...
def encrypt(data):
ciphera= make_cipher()
	...
def make_cipher():
	...
```

이런 자잘하게 나눠진 함수는 오히려 가독성을 해친다. 신경을 쓸곳이 너무 많고 추적이 너무 어렵다.

코드에 새로운 함수는 분명 가독성 비용이 들지만 위 코드같은 경우 가독성 비용이 너무 크기 때문에 오히려 가독성이 나빠졌다라고 할수 있다.

타 프로젝트에서도 사용된느 것이라면 나쁜것많은 아니지만 그 전에는 저런식의 함수선언은 좋지 않다.



### 요약

일반적인 목적의 코드를 프로젝트의 특정 코드에서 분리하라

이러한 기법은 하위문제의 해결책을 완전하고 정확하게 해줄수 있고 재사용성도 높일 수 있다.

## 11. 한 번에 하나씩



> 한 번에 하나의 작업만 수행하게 코드를 구성해야 한다.



코드가 한번에 한 가지만 일하는 절차

1. 코드가 수행하는 모든 '작업'을 나열한다. 우리는 '작업'이란 단어를 매우 유연하게 사용한다.이는 "이 객체가 정상적으로 존재하는지 확인하라"처럼 작은 일일 수도 있고, "트리 안에 있는 모든 노드를 방문하라"처럼 모호한 일일 수도 있다.

2. 이러한 작업을 분리하여 서로 다른 함수로 혹은 적어도 논리적으로 구분되는 영역에 놓을 수 있는 코드로 만들어라.



### 작업은 작을 수 있다.

코드가 정상적으로 작동하는지 확인하는 정신적 노동이 적어지는 것이 '이해하기 쉬운' 코드를 만드는 핵심이다.



### 객체에서 값 추출하기

'한번에 한 가지 일' 원리 적용하기



### 요약

작성한 코드가 읽기 어렵다면, 일단 수행하는 작업을 모두 나열하라.

나열된 작업 중  일부는 별도의 함수나 클래스로 쉽사리 분리할 수 있을 것이다. 작업은 원래 함수 내에서 별도의 논리적 '문단'으로 존재할수 있다. 어떻게 작업을 정확히 분리할까 분리된다는 중요하지 않다. 어려운 부분은 애초에 프로그램이 수행하는 모든 작은 일들을 빠뜨리지 않고 정확하게 서술하는 것이다.



## 12. 생각을 코드로 만들기



> 할머니에게 설명할 수 없다면 당신은 제대로 이해한 게 아닙니다.
>
> - 알버트 아인슈타인



코드를 더 명확히 만드는 간단한 과정

1. 코드가 할 일을 옆의 동료에게 말하듯이 평범한 영어로 묘사하라.
2. 이 설명에 들어가는 핵심적인 단어와 문구를 포착하라.
3. 설명과 부합하는 코드를 작정하라.



- 논리를 명확하게 설명하기
- 라이브러리를 알면 도움이 된다.



이외는 php와 jquery로 작성된 글이고 내장 라이브러리 활용 함수 영어 해석등 이라 직접 책으로 확인 바랍니다.



### 요약

프로그램을 영어로 설명하고 그 설명을 자연스러운 코드로 작성하라.

설명에서 사용된 다넝와 문구를 살펴보는 것은 코드에서 따로 분리할수 있느느 하위 문제를 판별하는데 도움을 준다.

자신의 문제를 쉬운 말로 설명할 수 없으면, 해당 문제는 빠져 있거나 아니면 제대로 정의되지 않은 것이다.

어떤 프로그램을 혹은 어떤 생각이 라도 설명하는 행위는 문제의 틀을 제대로 잡는 데 도움을 준다.



## 13. 코드 분량 줄이기



> 가장 읽기 쉬운 코드는 아무것도 없는 코드다



### 그 기능을 구현하려고 애쓰지 마라 - 그럴 필요가 없다



프로그래머는 대개 프로젝트에 정말 필요한 기능이 얼마나 있는지 과대평가 하는 경향이 있다.

반대로 어떤 기능을 구현하는데 필요한 노력을 과소평가하는 경향도 있다.



### 요구사항에 질문을 던지고 질문을 잘게 나누어 분석하라

프로그램이 반드시 빠르게 동작하고, 100% 정확하고 무든 종류의 기능을 처리해야 하는것은 아니다.

주어진 요구사항을 잘 분석하면 적은 코드로 간단한 문제를 정의할 수 있다.

> "요구사항 제거하기"와" 더 간단한 문제 해결하기"는 굉장히 이점이 있다.



### 코드베이스를 작게 유지하기

![image](https://user-images.githubusercontent.com/78361650/154800086-5e8b8650-ddb3-4187-9554-74436887727c.png)



프로젝트의 시작은 작지만 계속 수정과 프로젝트 규모가 커짐에 따라 기억하기 어려워지고 복잡해진다.

코드베이스를 최대한 작게 유지하는것이 최선의 대처 방법인데 이에는 다음과 같은 일이 필요하다.

- 일반적 '유틸리티'를 많이 생성하여 중복된 코드를 제거하라.
- 사용하지 않는 코드 혹은 필요 없는 기능을 제거하라.
- 프로젝트가 서로 분절된 하위 프로젝트로 구성되게 해라.
- 코드베이스의 '무게'를 항상 의식하여 가볍고 날렵하게 유지시켜라.



### 자기 주변에 있는 라이브러리에 친숙해져라



도움을 주는 조언 : **매일 15분씩 자신의 표준 라이브러리에 있는 모든 함수/ 모듈/형들의 이름을 읽어라.**



#### 라이브러리를 이요하면 왜 그렇게 좋을까

평균 수준의 엔지니어는 하루 10줄정도 작성한다고 한다.

라이브러리안에 있는 코드는 설계, 디버깅, 재작성, 문서화, 최저고하, 테스트를 거쳤다. 이러한 라이브러리를 사용하면 시간도 절약하고, 코드양도 줄어든다.



### 예: 코딩 대신 유닉스 도구를 활용하기

명령행 코드를 사용하면 우리가 '실제' 코드를 전혀 작성하지 않아도 되고, 따라서 소스코드 통제 시스템에 아무 것도 넣지 않아도 되므로 훌륭하다.



### 요약

새로 작성하는 코드를 모두 테스트하고, 문서화하고, 유지보수해야 한다. 더욱이 코드베이스에 더 많은 코드가 있으면 더 '무거워'져서 새로운 개발이 더 어렵게 된다.

- 제품에 꼭 필요하지 않는 기능을 제거하고, 과도한 작업을 피한다.
- 요구사항을 다시 생각해서, 가장 단순한 형태의 문제를 찾아본다.
- 주기적으로 라이브러리 전체 API를 훑어봄으로써 표준 라이브러리에 친숙해진다.





