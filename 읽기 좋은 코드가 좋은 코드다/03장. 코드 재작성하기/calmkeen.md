# 3. 코드 재작성하기



엔지니어링은 커다란 문제를 작은 문제로 쪼갠 다음, 각각의 문제에 대한 해결책을 구하고 하나의 해결책으로 맞추는 일련의 작업을 하는것인데 이를 코드에 적용하면 코드가 튼튼하며 가독성이 좋아진다.



**큰 흐름과 관계가 적은 하위문제를 적극적으로 발견해서 추출하라는 것의 의미**

1. 주어진 함수나 코드 불럭을 보고 상위수준에서 본 이 코드의 목적은 무엇인가?
2. 코드의 모든 줄에 질문을 던져라. "이 코드는 직접적으로 목적을 위해서 존재하는가?" 혹은 목적을 위해서 필요하긴 하지만 목적 자체와 직접적으로 상관없는 하위문제를 해결하는가?
3. 만약 상당히 원래 목적과 직접적으로 관련되지 않은 하위 문제를 해결하는 코드 분량이 많으면 이를 추출해서 별도 함수로 만든다.



## 순수한 유틸리티 코드



문자열 변경, 파일 읽기 /쓰기와 같이 프로그램이 수행하는 일에는 기본적인 작업을 포괄하는 핵심적인 집합이 있다.

이러한 기본 유틸은 프로그래밍 내장 라이브러리에 있는데 이런 일을 스스로 구현할 때도 있다.

라이브러리에 원하는 함수가 없다면 스스로 작성해 유틸리티 코드 모음을 만들어 놓아라.



### 일반적인 목적의 코드



코드를 추출하면 함수를 호출하는 코드를 간단하게 만들고 다른곳에서도 사용할수 있게 만드는 장점이 있다.

함수를 손쉽게 개선하고 기능을 더하고 가독성을 개선하고 코너케이스를 다루는 일이 쉽게 된다.





### 일반적인 목적을 가진 코드를 많이 만들어라



일반적인 목적을 가진 코드는 프로젝트의 나머지 부분에서 완전히 분리되므로 좋다.

이러한 코드는 개발하고, 테스트하고 이해도 쉽다.

SLQ DB, javascript, html등 여러 라이브러리는 프로젝트에서 완전히 분리되어 있다.

이때문에 코드베이스는 그만큼 작아질수 있는것이다.



### 특정한 프로젝트를 위한 기능



Business객체를 만들어 값을 설정하는 정규적 패턴을 갖는 코드 예

```
business =Buisiness()
businesss.name = request.POST["name"]
businesss.url = "/biz/" + make_url_friednly(business.name)
businesss.data = datattime.dataetime.utnow()
business.save_to_database()

def make_url+friendly(text):
 ...
```

코드의 가독성을 높히는 코드이기도 하다.



### 기존의 인터페이스를 단순화하기

모든 사람은 라이브러리가 깔끔하고 설정을 요구하지 않으며 간편한 인터페이스를 좋아한다.

이상적이지 않은 인터페이스를 받아들일 이유는 없다.

이러한 인터페이스는 이를 둘러싸는 함수(wrapper)로 지저분한 내부를 감출 수 있다.



### 지나치게 추출하기



대부분 프로그래머는 충분히 적극적이지 않지만 간혹 너무 흥분해 지나치게 나아가는 경우도 있다.

```
ex)
def url_safe_encrypt(obj):
	...
def url_encrypt_str(data):
	...
def encrypt(data):
	return base64.url...
def encrypt(data):
ciphera= make_cipher()
	...
def make_cipher():
	...
```

이런 자잘하게 나눠진 함수는 오히려 가독성을 해친다. 신경을 쓸곳이 너무 많고 추적이 너무 어렵다.

코드에 새로운 함수는 분명 가독성 비용이 들지만 위 코드같은 경우 가독성 비용이 너무 크기 때문에 오히려 가독성이 나빠졌다라고 할수 있다.

타 프로젝트에서도 사용된느 것이라면 나쁜것많은 아니지만 그 전에는 저런식의 함수선언은 좋지 않다.



### 요약

일반적인 목적의 코드를 프로젝트의 특정 코드에서 분리하라

이러한 기법은 하위문제의 해결책을 완전하고 정확하게 해줄수 있고 재사용성도 높일 수 있다.
