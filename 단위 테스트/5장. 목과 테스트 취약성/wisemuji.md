# 목과 테스트 취약성


## 목과 스텁 구분
![image](https://user-images.githubusercontent.com/32327475/193534574-52b7c89e-016e-4138-be27-a3115063cdea.png)
![image](https://user-images.githubusercontent.com/32327475/193534895-dbd6264b-aa53-4421-88b5-4e1e373ca0b8.png)

- 목: 외부로 나가는 상호작용을 모방하고 검사하는데 도움됨
  - SUT가 상태를 변경하기 위한 의존성을 호출
- 스텁: 내부로 들어오는 상호 작용을 모방하는데 도움됨 
  - SUT가 입력 데이터를 얻기 위한 의존성을 호출

### 스텁으로 상호 작용을 검증하지 말라

> 스텁과 상호작용을 검증하는 것은 취약한 테스트를 야기하는 일반적인 안티 패턴이다.

최종 결과가 아닌 사항을 검증하는 관행을 과잉 명세라고 부른다.

SUT에서 스텁으로의 호출은 SUT가 생성하는 최종 결과가 아니다. 최종 결과를 산출하기 위한 수단일 뿐이다. 

## 식별할 수 있는 동작과 구현 세부 사항

모든 제품 코드는 2차원으로 분류할 수 있다.

- 공개 API 또는 비공개 API
- 식별할 수 있는 동작 또는 구현 세부 사항

각 차원의 범주는 겹치지 않는다.

코드가 시스템의 식별할 수 있는 동작이려면 다음 중 하나를 해야 한다.

- 클라이언트가 목표를 달성하는 데 도움이 되는 연산을 노출하라.
- 클라이언트가 목표를 달성하는 데 도움이 되는 상태를 노출하라.

잘 설계된 코드는 관찰 가능한 동작이 공개 API와 일치하고 구현 세부 정보가 비공개 API 뒤에 숨겨져 있다. 

![image](https://user-images.githubusercontent.com/32327475/193535569-ba2ac690-8dc4-4f9d-bccb-0fc929bbb91a.png)

공개 API가 관찰 가능한 동작 이상으로 확장될 때 구현 세부 정보를 노출한다.

![image](https://user-images.githubusercontent.com/32327475/193535601-01f28b57-948c-4d3b-8265-39836b851108.png)

## 목과 테스트 취약성 간의 관계
![image](https://user-images.githubusercontent.com/32327475/193536372-6d4b85ec-0a55-47af-abb2-cf7c27693ce0.png)

육각형 아키텍처는 육각형으로 표현되는 상호 작용하는 응용 프로그램 세트다. 각 육각형은 도메인 및 애플리케이션 서비스의 두 계층으로 구성된다.
도메인 계층에는 애플리케이션의 비즈니스 로직이 포함된다. 애플리케이션 서비스는 해당 로직을 비즈니스 유즈케이스에 연결한다.

육각형 아키텍처는 세 가지 중요한 측면을 강조한다.
- 도메인 및 애플리케이션 서비스 계층 간의 문제 분리. 
  - 도메인 계층은 비즈니스 로직을 담당해야 하며 애플리케이션 서비스는 도메인 계층과 외부 애플리케이션 간의 작업을 조정해야 한다.
- 애플리케이션 서비스 계층에서 도메인 계층으로의 단방향 종속성 흐름.
  - 도메인 계층 내부의 클래스는 서로에만 의존해야 한다. 애플리케이션 서비스 계층의 클래스에 의존해서는 안 된다.
- 외부 응용 프로그램은 응용 프로그램 서비스 계층에서 유지보수하는 공통 인터페이스를 통해 응용 프로그램에 연결한다. 아무도 도메인 계층에 직접 액세스할 수 없다.

육각형의 각 레이어는 관찰 가능한 동작을 나타내며 고유한 구현 세부 정보 집합을 포함한다.

## 단위 테스트의 고전파와 런던파 재고

### 모든 프로세스 외부 의존성을 목으로 해야 하는 것은 아니다

- 공유 의존성 : 테스트 간에 공유하는 의존성
- 프로세스 외부 의존성: 프로그램의 실행 프로세스 외에 다른 프로세스를 점유하는 의존성
- 비공개 의존성: 공유하지 않는 모든 의존성

종종 목이 동작을 검증한다고 하지만 대부분의 경우 그렇지 않다. 
목은 시스템 간 통신(응용 프로그램 경계를 넘는 통신)에 사용되는 경우와 이러한 통신의 사이드 이펙트가 외부 세계에 노출되는 경우에만 사용하는 것이 좋다.
