# 가치 있는 단위 테스트를 위한 리팩터링

## 리팩터링할 코드 식별하기

- 도메인 중요성은 코드가 프로젝트의 문제 도메인에 얼마나 중요한지를 보여준다. 복잡한 코드는 종종 높은 도메인 중요성을 가진다.
- 다수의 공동 작업자가 있는 코드를 다루는 단위 테스트는 유지 관리 비용이 높다. 
- 이러한 테스트는 협력자를 예상 조건으로 가져온 다음 나중에 협력자의 상태 또는 상호 작용을 확인하기 위해 많은 공간이 필요하다.

### 코드의 네 가지 유형

![image](https://user-images.githubusercontent.com/32327475/195042173-cffbfb83-7600-4c60-900c-9df8c4ae4d63.png)

모든 프로덕션 코드는 복잡성이나 도메인 중요성, 협력자 수에 따라 4가지 유형의 코드로 분류할 수 있다. (코드 복잡도는 코드의 분기 수로 정의된다.)

도메인 모델 및 알고리즘(높은 복잡성 또는 도메인 중요성, 소수의 협력자): 단위 테스트 노력에 대한 최상의 수익을 제공
사소한 코드(낮은 복잡성 및 도메인 중요성, 소수의 공동 작업자): 테스트할 가치가 전혀 없음
컨트롤러(낮은 복잡성 및 도메인 중요성, 많은 수의 공동 작업자): 통합 테스트를 통해 간략하게 테스트해야 함
지나치게 복잡한 코드(높은 복잡성 또는 도메인 중요성, 많은 수의 공동 작업자): 컨트롤러와 덜 복잡한 코드로 분할해야 함

코드가 더 중요하거나 복잡할수록 더 적은 수의 협력자가 있어야 한다.

> 나쁜 테스트를 만들 바에 전혀 테스트를 작성하지 않는 것이 좋다

### 험블 객체 패턴을 사용해 지나치게 복잡한 코드 분할하기

험블 객체 패턴은 코드에서 비즈니스 로직을 별도의 클래스로 추출하여 지나치게 복잡한 코드를 테스트할 수 있도록 도와준다.
결과적으로 나머지 코드는 컨트롤러가 되어 비즈니스 로직을 감싸는 험블한 rapper가 된다.

어려운 종속성과 결합하는 코드를 테스트하는 것은 어렵다. 테스트는 이러한 종속성을 처리해야 하므로 유지 관리 비용이 증가한다.

## 결론

> 추상화를 테스트하는 것이 추상화보다 더 쉽다.

컨트롤러에 비즈니스 논리가 있는 것을 피할 수 없는 것처럼 도메인 클래스에서 모든 공동작업자를 제거할 수 있는 경우는 거의 없다. 
공동작업자가 프로세스 외 종속성을 참조하지 않는 한, 둘 또는 셋의 공동작업자가 도메인 클래스를 지나치게 복잡한 코드로 만들지 않는다.
