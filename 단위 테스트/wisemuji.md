# 1장. 단위 테스트의 목표

이 장에서 다루는 내용

- 단위 테스트의 상태
- 단위 테스트의 목표
- 좋지 않은 테스트 스위트의 결과
- 테스트 스위트 커버리지 지표 
- 성공적인 테스트 스위트의 속성

## 단위 테스트 현황

"좋은 단위 테스트를 작성하는 것은 어떤 의미인가?"는 아직도 논쟁이 많은 주제 중 하나다.

코드는 점점 나빠지는 경향이 있다. 테스트는 안정망 역할을 하며 대부분의 회귀에 대한 보험을 제공하는 도구라 할 수 있다.

### 단위 테스트의 목표

단위 테스트 활동이 더 나은 설계로 이어진다고들 많이 하는데 이는 단위 테스트의 주목표는 아니다. 더 나은 설계는 단지 좋은 부수 효과일 뿐이다.

단위 테스트의 목표는 소프트웨어 프로젝트의 *지속 가능한 성장*을 가능하게 하는 것이다.

(테스트가 없는 일반 프로젝트의 성장 추이, 소프트웨어 엔트로피라고도 부름)
![image](https://user-images.githubusercontent.com/32327475/185790678-1cf2fcfd-196f-4525-9598-3307081781ed.png)
- 처음에는 발목을 잡을 것이 없으므로 빨리 시작할 수 있다
- 하지만 시간이 지나면서 점점 더 많은 시간을 들여야 처음에 보여준 것과 같은 진척을 낼 수 있다.
- 테스트는 새로운 기능을 도입하거나 새로운 요구 사항에 더 잘 맞게 리팩터링한 후에도 기존 기능이 잘 작동하는지 확인하는 데 도움이 된다.

## 좋은 테스트와 좋지 않은 테스트를 가르는 요인

테스트가 잘못 작성된 프로젝트는 초반에는 테스트가 잘 작성된 프로젝트의 속성을 보여주지만 결국 침체 단계에 빠진다.

프로젝트에 테스트를 더 많이 실행하더라도 단위 테스트의 목표를 달성할 수 없다. 테스트의 가치와 유지 비용을 모두 고려해야 한다.
- 기반 코드를 리팩터링할 때 테스트도 리팩터링하라
- 각 코드 변경 시 테스트를 실행하라
- 테스트가 잘못된 경고를 발생시킬 경우 처리하라
- 기반 코드가 어떻게 동작하는지 이해하려고 할 때는 테스트를 읽는 데 시간을 투자하라

테스트 코드도 제품 코드와 동일하게 버그에 취약하고 유지보수가 필요하므로 가능한 적은 코드로 문제를 해결하여 유지비를 줄이는 것이 좋다.

## 테스트 스위트 품질 측정을 위한 커버리지 지표

코드 커버리지 지표는 테스트 스위트가 소스 코드를 얼마나 실행하는지를 백분율로 나타낸다.

코드 커버리지가 너무 적을 때는 테스트가 충분치 않다는 좋은 증거가 될 수 있다. 그러나 높은 커버리지의 테스트 코드가 항상 양질의 테스트 스위트라고 보장하지는 않는다.

### 커버리지 지표에 대한 이해

```
코드 커버리지(테스트 커버리지) = 실행 코드 라인 수 / 전체 라인 수
```

```
분기 커버리지 = 통과 분기 / 전체 분기 수
```

### 커버리지 지표에 관한 문제점

분기 커버리지로 코드 커버리지보다 더 나은 결과를 얻을 수 있지만 테스트 스위트의 품질을 결정하는 데 어떤 커버리지 지표도 의존할 수 없는 이유는 다음과 같다
- 테스트 대상 시스템의 모든 가능한 결과를 검증한다고 보장할 수 없다
- 외부 라이브러리의 코드 경로를 고려할 수 있는 커버리지 지표는 없다
  - 수많은 예외 상황에 빠질 수 있지만 테스트에서 모든 예외 상황을 다루는지 확인할 방법이 없다

### 특정 커버리지 숫자를 목표로 하기

시스템의 핵심 부분은 커버리지를 높게 두는 것이 좋다. 하지만 이 높은 수준을 요구사항으로 삼는 것은 좋지 않다. 그 차이는 미미하지만 매우 중요하다.

다시 말하면 커버리지 지표는 좋은 부정 지표이지만 나쁜 긍정 지표다. 

## 무엇이 성공적인 테스트 스위트를 만드는가?

성공적인 테스트 스위트는 다음과 같은 특성을 갖고 있다.
- 개발 주기에 통함돼 있다
- 코드베이스에서 가장 중요한 부분만을 대상으로 한다
  - 이 지침을 따르려면 도메인 모델을 코드베이스 중 중요하지 않은 부분과 분리해야 한다. 도메인 모델을 다른 애플리케이션 문제와 분리해야 단위 테스트에 대한 노력을 도메인 모델에만 집중할 수 있다
- 최소한의 유지비로 최대의 가치를 끌어낸다
