# 3. 단위 테스트 구조

# 단위 테스트를 구성하는 방법

## AAA 패턴 사용

준비, 실행, 검증으로 나뉜다.

- 준비 구절에서는 테스트 대상 시스템(SUT)과 해당 의존성을 원하는 상태로 만든다.
- 실행 구절에서는 SUT에서 메세드를 호출하고 준비된 의존성을 전달하며 출력 값을 캡처한다.
- 검증 구절에서는 결과를 검증한다. 결과는 반환 값이나 SUT와 협력자의 최종 상태, SUT가 협력자에 호출한 메서드 등으로 표시될 수 있다.

### 1. 여러 개의 준비, 실행, 검증 구절 피하기

> 준비 → 실행 → 검증 → 좀 더 실행 → 다시 검증
> 

이건 단위 테스트가ㅣ 아닌 통합 테스트이다. 각 동작을 고유의 테스트로 도출해야한다.

### 2. 테스트 내 if 문 피하기

단위 테스트든 통합 테스트든 테스트는 분기가 없는 간단한 일련의 단계여야 한다.

### 3. 각 구절은 얼마나 커야 하는가?

- 일반적으로 준비 구절이 가장 크다.
    - 너무 크다면 오브젝트 마더, 테스트 데이터 빌더를 고려해보자
    

### 4. 검증 구절에는 검증문이 얼마나 있어야 하는가

하나의 테스트로 그 모든 결과를 평가하는 것이 좋다.

단, 너무 커지는 것은 경계해야 한다. 모든 속성을 검증하는 대신 객체 클래스 내에 적절한 동등 멤버를 정의하는 것이 좋다.

### 5. 종료 단계는 어떤가

대부분의 단위 테스트는 종료 구절이 필요없다.

단위 테스트는 프로세스 외부에 종속적이지 않기 때문이다.

### 6. 테스트 대상 시스템 구별하기

SUT를 의존성과 구분하는 것은 중요하다.

테스트 내 SUT 이름을 sut로 하라.

### 7. 준비, 실행, 검증 주석 제거하기

- AAA 패턴을 따르고 준비 및 검증 구절에 빈 줄을 추가하지 않아도 되는 테스트라면 구절 주석들을 제거하라
- 그렇지 않으면 구절 주석을 유지하라.

# 테스트 간 테스트 픽스처 재사용

> 텍스트 픽스처를 재사용 하는 올바르지 않은 방법
> 

→ 테스트 생성자나 SetUp 특성으로 표시된 메서드에서 픽스처를 초기화하는 것 (92p)

- 테스트 간 결합도가 높아진다.
- 테스트 가독성이 떨어진다.

> 더 나은 테스트 픽스처 재사용법
> 

→ 테스트 클래스에 비공개 팩토리 메서드를 추가하는 것 (94p)

# 단위 테스트 명명법

> 올바르지 않은 방법
> 

[테스트 대상 메서드]_[시나리오]_[예상 결과]

- 테스트 대상 메서드 : 테스트 중인 메서드의 이름
- 시나리오 : 메서드를 테스트하는 조건
- 예상 결과 : 현재 시나리오에서 테스트 대상 메서드에 기대하는 것

→ 가독성이 좋지 않고 읽는데 부담이 가중된다.

> 표현력 있고 읽기 쉬운 테스트 이름을 짓는 방법
> 
- 엄격한 명명 정책은 따르지 않는다. 표현의 자유를 허용하자
- 문제 도메인에 익숙한 비개발자들에게 시나리오를 설명하는 것처럼 테스트 이름을 짓자
- 단어를 밑줄 표시로 구분한다.

# 매개변수화된 테스트 리팩터링하기

매개변수화를 하게 되면 테스트 코드의 양을 크게 줄일 수 있지만, 비용이 발생한다.

입력 매개변수만으로 테스트 케이스를 판단할 수 있다면 긍정적인 테스트 케이스와 부정적인 테스트 케이스 모두 하나의 메서드로 두는 것이 좋다. 

그렇지 않으면 긍정적인 테스트 케이스를 도출하라. 동작이 너무 복잡하면 매개변수화 된 테스트를 조금이라도 사용하지 말라.

# 검증문 라이브러리를 사용한 테스트 가독성 향상

[주어] [행동] [목적어]로 읽을 수 있는 패턴을 사용하자.

Fluent Assertions 같은 라이브러리