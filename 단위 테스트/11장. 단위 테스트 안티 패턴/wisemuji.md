# 단위 테스트 안티 패턴

## 비공개 메서드 단위 테스트

단위 테스트를 가능하게 하기 위해 private 메서드를 노출하면 테스트를 구현에 연결하고 궁극적으로 리팩토링에 대한 테스트의 저항을 손상시킨다. 

private 메서드를 직접 테스트하는 대신, 가장 중요한 관찰 가능한 동작의 일부로 간접적으로 테스트하라.

### 비공개 메서드와 테스트 취약성

private 메서드가 너무 복잡하여 이를 사용하는 공개 API의 일부로 테스트할 수 없다면 추상화가 누락되었음을 나타낸다. 

private 메서드를 public으로 만드는 대신 이 추상화를 별도의 클래스로 추출한다.

### 비공개 메서드 테스트가 타당한 경우

드문 경우로 클래스의 관찰 가능한 동작에 속하는 private 메서드가 있다. 이러한 메서드는 일반적으로 클래스와 ORM 또는 팩토리 간의 비공개 계약을 구현한다.

## 비공개 상태 노출

단위 테스트의 목적으로만 비공개로 유지하려는 상태를 노출하지 마라. 테스트는 프로덕션 코드와 정확히 동일한 방식으로 테스트 중인 시스템과 상호 작용해야 한다.

## 테스트로 유출된 도메인 지식

테스트를 작성할 때 특정 구현을 암시하지 마라. 블랙박스 관점에서 프로덕션 코드를 확인한다. 테스트에 대한 도메인 지식 누출을 방지하라.

## 코드 오염

코드 오염은 테스트에만 필요한 프로덕션 코드를 추가하는 것이다. 테스트 코드와 프로덕션 코드를 혼동시키고 유지 관리 비용을 증가시키기 때문에 안티 패턴이다.

## 구체 클래스를 목으로 처리하기

기능의 일부를 유지하기 위해 구체적인 클래스를 모킹해야 할 필요성은 단일 책임 원칙을 위반한 결과이다.

해당 클래스를 두 개의 클래스로 분리하여 하나는 도메인 로직을 사용하고 다른 하나는 외부 종속성을 다루자.

## 시간 처리하기

현재 시간을 엠비언트 컨텍스트로 나타내면 프로덕션 코드가 오염되고 테스트가 더 어려워진다. 서비스 또는 일반 값으로 명시적 종속성으로 시간을 주입하라. 가능하면 정적인 값을 선호하자.
