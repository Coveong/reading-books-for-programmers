# 단위 테스트란 무엇인가

2장에서 다루는 내용
- 단위 테스트란
- 공유 의존성, 비공개 의존성, 휘발성 의존성 간의 차이점
- 단위 테스트의 두 분파: 고전파와 런던파
- 단위 테스트, 통합 테스트, 엔드 투 엔드 테스트의 차이점

단위 테스트에 접근하는 방법에는 많은 견해가 있고 크게 고전파와 런던파로 알려져 있다.

## 단위 테스트의 정의

단위 테스트는
- 작은 코드 조각(단위라고도 함)을 검증하고
- 빠르게 수행하고
- 격리된 방식으로 처리하는 자동화된 테스트다

### 격리 문제에 대한 런던파의 접근

런던파에서는 하나의 클래스가 다른 클래스 또는 여러 클래스에 의존하면 이 모든 의존성을 테스트 대역(test double)으로 대체해야 한다.

- 테스트 대상 시스템만 검증하는 데에 집중할 수 있을 뿐만 아니라 규모가 큰 상호 연결 객체 그래프를 분할할 수 있음
- 단순한 테스트 스위크 구조(제품 코드의 각 클래스에 대해 테스트 클래스가 하나씩 있는 구조)를 확립하는 데 도움이 됨

### 격리 문제에 대한 고전파의 접근

고전적인 방법에서 코드를 꼭 격리하는 방식으로 테스트해야 하는 것은 아니지만 단위 테스트에서는 서로 격리해서 실행해야 한다. 이렇게 하면 테스트를 어떤 순서로든 가장 적합한 방식으로 실행할 수 있으며 서로의 결과에 영향을 미치지 않는다.

- 공유 의존성: 테스트 간에 공유되고 서로의 결과에 영향을 미칠 수 있는 수단을 제공하는 의존성 (예: static mutable field)
- 비공개 의존성: 공유하지 않는 의존성
- 프로세스 외부 의존성: 애플리케이션 실행 프로세스 외부에서 실행되는 의존성 (예: 데이터베이스는 프로세스 외부이면서 공유 의존성임)

단위 테스트를 서로 격리하는 것은 테스트 대상 클래스에서 공유 의존성만 격리하는 것을 의미한다. 비공개 의존성은 그대로 둘 수 있다.

공유 의존성은 테스트 대상 클래스 간이 아니라 단위 테스트 간에 공유한다. (예: 싱클턴 의존성은 각 테스트에서 새 인스턴스를 만들 수 있기만 하면 공유되지 않는다)

## 단위 테스트의 런던파와 고전파

|X|격리 주체|단위의 크기|테스트 대역 사용 대상|
|---|---|---|---|
|런던파|단위|단일 클래스|불변 의존성 외 모든 의존성|
|고전파|단위 테스트|단일 클래스 또는 클래스 세트|공유 의존성|

단, 모든 프로세스 외부 의존성이 공유 의존성의 범주에 속하는 것은 아니다.

- 공유이지만 프로세스 외부가 아닌 의존성의 예: 싱클톤(모든 테스트에서 재사용하는 인스턴스), 클래스의 정적 필드 등
- 공유이면서 프로세스 외부에 있는 예: 데이터베이스(프로세스 외부에 상주하며 변경이 가능하다)
- 프로세스 외부에 있지만 공유되지 않는 예: 읽기 전용 API(수정할 수 없고 서로의 실행 흐름에 영향을 줄 수 없기 때문)

## 고전파와 런던파의 비교

고전파와 런단파 간의 주요 차이는 단위 테스트의 정의에서 격리 문제를 어떻게 다루는지에 있다. 필자는 개인적으로 고전파를 선호한다.

[런던파의 장점]
- 입자성이 좋다. 테스트가 세밀해서 한 번에 한 클래스만 확인한다
- 서로 연결된 클래스의 그래프가 커져도 테스트하기 쉽다
- 테스트가 실패하면 어떤 기능이 실패했는지 확실히 알 수 있다

[런던파의 문제점]
- **과잉 명세 - SUT 세부 구현에 결합된 테스트 문제**
- 테스트 대상 클래스에 대한 초점이 잘못됐다. 테스트는 코드 단위가 아니라 동작 단위를 검증해야 한다.
- 코드 조각 단위를 테스트할 수 없다는 것은 코드 설계에 문제가 있다는 사실을 알려주는 강한 징후다.
- 테스트 실패 후 어떤 기능에 버그가 있는지 판단하는 것이 도움은 되지만 종종 버그의 원인을 알고 있기 때문에 그리 큰 문제는 아니다
  - 즉 바로 마지막에 실행할 것이 버그의 원인일 것이다.

## 통합 테스트

단위 테스트 기준 중 하나 이상을 충족하지 못하는 테스트. E2E 테스트는 통합 테스트의 일부다. E2E 테스트는 어플리케이션과 함께 작동하는 프로세스 외부 의존성이 전부 또는 대부분에 직접 접근한다
