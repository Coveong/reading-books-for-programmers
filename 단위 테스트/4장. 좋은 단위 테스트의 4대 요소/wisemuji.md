# 좋은 단위 테스트의 4대 요소 자세히 살펴보기
- 회귀 방지
- 리팩터링 내성
- 빠른 피드백
- 유지 보수성

## 첫 번째 요소: 회귀 방지

회귀: 소프트웨어 버그. 코드 수정 후 기능이 의도한 대로 작동하지 않는 경우

회귀를 방지하기 위해 다음을 고려해야 한다.
1. 테스트 중에 실행되는 코드의 양
2. 코드 복잡도
3. 코드의 도메인 유의성

비지니스 로직 코드가 보일러플레이트(재사용이 가능한 코드)보다 더 중요하다.

## 두 번째 요소: 리팩터링 내성

리팩토링 내성: 테스트를 실패로 바꾸지 않고 기존 애플리케이션 코드를 리팩토링할 수 있는지에 대한 척도

- 기존 기능이 고장 났을 때 테스트가 조기 경고를 제공
- 코드 변경이 회귀로 이어지지 않을 것이라고 확신할 수 있음

거짓 양성: 기능은 의도한 대로 작동하지만 테스트는 실패를 나타냄

- 테스트가 이유 없이 실패한다면 나중에는 실패를 무시하게 됨
- 거짓 양성이 빈번하면 테스트 코드에 신뢰가 점점 떨어지고 테스트로써 의미를 잃게 됨
![image](https://user-images.githubusercontent.com/32327475/193532148-e390dc9a-2375-441f-abac-b029f0fc7e8d.png)


구현 세부 사항 대신 최종 결과를 목표로 한다면 거짓 양성을 줄일 수 있음

### 회귀 방지와 리팩토링 내성의 관계
**[테스트 정확도 극대화]** 

거짓 양성을 피하는 데에 리팩터링 내성이 도움이 된다.

![image](https://user-images.githubusercontent.com/32327475/193532205-264f9515-93e2-422c-a82a-243c2dbd8334.png)

**[거짓 양성과 거짓 음성의 중요성]**

단기적으로는 거짓 긍정이 거짓 부정만큼 나쁘지 않다. 프로젝트 초기에 잘못된 경고를 받는 것은 전혀 경고를 받지 않고 프로덕션에 버그가 미끄러질 위험이 있는 것과 달리 그렇게 큰 문제가 아니다. 

그러나 프로젝트가 성장함에 따라 점점 더 큰 영향을 미치기 시작한다. 이를 줄이기 위해 정기적으로 리팩터링을 해야한다.

![image](https://user-images.githubusercontent.com/32327475/193532346-89b8d4c1-d139-479c-8d04-b0cdaab3bb9b.png)


## 세 번째 요소와 네 번째 요소: 빠른 피드백과 유지 보수성

느린 테스트는 피드백을 느리게 하고 잠재적으로 버그를 뒤늦게 눈에 띄게 할 가능성이 있어 버그 수정 비용이 증가한다.

오래 걸리는 테스트는 자주 실행하지 못하기 때문에 잘못된 방향으로 가면서 더 많은 시간을 낭비하게 된다.

- 테스트가 얼마나 이해하기 어려운가?
  - 테스트 크기와 관련이 있다. 작은 테스트는 필요할 때 변경하기 쉽지만 반대는 어렵다.
- 테스트가 얼마나 실행하기 어려운가?
  - 외부 종속성으로 작동하면 상시 운영하는데 시간을 들여야 한다.

## 이상적인 테스트를 찾아서

![image](https://user-images.githubusercontent.com/32327475/193533147-19d7b994-30a5-49ba-bf90-a8804d7c1b48.png)

- E2E 테스트는 회귀 오류와 거짓 양성에 대한 보호를 훌륭히 해내지만 빠른 피드백의 지표에서 실패했다
- 간단한 테스트는 우수한 리팩토링 내성과 빠른 피드백을 제공하지만 회귀 방지가 어렵다
- 깨지기 쉬운 테스트는 빠르게 실행되고 회귀 방지를 훌륭히 해내지만 리팩토링 내성은 거의 없다

### 테스트 피라미드 분해

테스트 유형 간의 정확한 비율은 각 팀과 프로젝트마다 다르지만 일반적으로 피라미드 형태를 유지해야 한다. 

end-to-end 테스트가 가장 적고, 단위 테스트가 가장 많으며, 통합 테스트는 중간 어딘가에 있어야 한다.


## 블랙박스 테스트와 화이트박스 테스트 간의 선택

- 화이트 박스: 내부 작업을 검증하는 테스트 방법. 테스트는 요구 사항이나 명세가 아닌 소스코드에서 파생
- 블랙 박스: 시스템의 내부 구조를 모르더라도 시스템 기능을 검사할 수 있는 테스트 방법. 일반적으로 명세와 요구사항, 즉 애플리케이션이 어떻게 해야 하는지가 아니라 무엇을 해야 하는지를 중심으로 구축됨

| X | Protection against regressions | Resistance to refactoring | 
|---|---|---|
| White-box testing |	Good | Bad | 
|	Black-box testing |	Bad |	Good |	
