# 1장 단위 테스트의 목표

## 단위 테스트의 목표

> 코드베이스
- 특정 소프트웨어를 만드는데 사용된 소스 코드의 전체 집합
> 

단위 테스트의 목표는 **소프트웨어 프로젝트의 지속 가능한 성장을 가능하게 하는 것**입니다.

**🤔 지속 가능하지 않다면?**

소프트웨어 엔트로피 현상(품질을 떨어뜨리는 코드) 발생해 코드베이스 신뢰할 없고 안정화가 어렵습니다.

테스트는 안정망 역할을 하며, 대부분의 회귀에 대한 보험을 제공하는 도구입니다. 

> 회귀
- 특정 사건(코드 수정) 후 기능이 의도한 대로 작동하지 않는 경우 (동의어 : 버그)
> 

### [단위 테스트와 코드 설계의 관계]

코드 조각을 단위 테스트 하기 어렵다 = 코드 품질이 나쁘다

코드 조각을 단위 테스트 할 수 있다 ≠ 코드 품질이 좋다

### [좋은 테스트와 좋지 않은 테스트]

- 프로젝트에 도움 되는지 여부 파악 않고, 단위 테스트만 작성하는 문제 발생
- 테스트의 가치와 유지 비용을 모두 고려 필요
    - 기반 코드를 리팩터링할 때 테스트도 리팩터링하라.
    - 각 코드 변경 시 테스트를 실행하라.
    - 테스트가 잘못된 경고를 발생시킬 경우 처리하라.
    - 기반 코드가 어떻게 동작하는지 이해하려고 할 떄는 테스트를 읽는 데 시간을 투자하라.
- 고품질 테스트에만 집중해야 함

### [제품 코드 vs 테스트 코드]

코드는 자산이 아닌 책임으로, 코드가 더 많아질수록, 프로젝트 유지비가 증가합니다.

테스트도 역시 코드로, 애플리케이션의 정확성을 보장하는 것을 목표로하는 코드베이스의 일부로 봐야 합니다.

## 커버리지 지표

> 커버리지 지표
- 테스트 스위트가 소스 코드를 얼마나 실행하는지를 백분율로 나타내며, 숫자가 높을 수록 좋음
> 

커버리지 지표는 널리 사용되는 두 가지가 있으며 테스트 스위트의 품질을 평가하는데 자주 사용됩니다.

- 코드 커버리지
- 분기 커버리지

하지만, 커버리지 지표는 피드백을 주더라도 테스트 품질을 효과적으로 측정할 수는 없습니다.

- 코드 커버리지가  적을 때 = 테스트 보장되지 않음
- 코드 커버리지가 높을 때 ≠ 양질의 테스트 보장

### [코드 커버리지]

> 코드 커버리지 (테스트 커버리지)
- 테스트로 실행된 코드 라인수와 제품 코드 베이스의 전체 라인 수의 비율 나타냄
> 

```
코드 커버리지 = 전체 라인 수/실행 코드 라인 수
```

### [분기 커버리지]

> 분기 커버리지
- 테스트가 통과한 제어 구조의 수를 나타내며, 코드 커버리지의 단점 극복해 정확한 결과 제공
> 

```
코드 커버리지 = 전체 분기 수/통과 분기
```

### [커버리지 지표 문제점]

- 테스트 대상 시스템의 모든 가능한 결과 검증 보장 할 수 없음
- 외부 라이브러리의 코드 경로 고려 가능한 커버리지 지표 없음

위와 같은 이유로, 테스트 스위트의 품질을 결정하는 데 어떤 커버리지 지표도 의존할 수 없습니다.

### [커버리지 숫자를 목표로 하기]

커버리지 지표를 보는 가장 좋은 방법은 지표 그 자체로, 목표로 여겨서는 안 됩니다.

→ 시스템의 핵심 부분은 커버리지를 높게 두는 것이 좋지만, 높은 수준의 요구 사항으로 삼는 것은 좋지 않습니다.

## 성공적인 테스트 스위트 특성

- 개발 주기에 통합돼 있습니다.
- 코드베이스 중 가장 중요한 부분만을 대상으로 합니다.
- 최소한의 유지비로 최대의 가치를 끌어냅니다.

### [개발 주기에 통합돼 있음]

이상적으로는 코드가 변경될 때마다 아무리 작은 것이라도 실행해야 합니다.

### [코드베이스에서 가장 중요한 부분만을 대상으로 함]

시스템의 가장 중요한 부분에 대한 테스트 노력을 기울이고, 다른 부분은 간략하게 검증하는 것이 좋습니다.

- 중요한 부분
    - 비즈니스 로직 (도메인 모델)
- 다른 모든 부분
    - 인프라 코드
    - DB나 서드파티 시스템과 같은 외부 서비스 및 종속성
    - 모든 것을 하나로 묶는 코드

중요하지 않은 부분을 포함하면 전체적인 시스템 파악할 수 있지만, 초점은 도메인 모델에 있어야 합니다.

### [최소 유지비로 최대 가치를 끌어냄]

최소 유지비로 최대 가치를 달성하는 것이 핵심입니다. 

그렇기 위해선, 가치가 유지비를 상회하는 테스트만 스위트에서 유지하는 것이 중요합니다.

- 가치 있는 테스트 식별하기
    - 식별 기준틀 필요
- 가치 있는  테스트 작성하기
    - 코드 설계 기술 필요

단위 테스트와 기반 코드는 서로 얽혀 있어, 코드베이스 개발에 많은 노력 필요합니다.

## 요약

- 테스트는 안전망 역할을 하며, 대부분의 회귀에 대한 보험을 제공하는 도구임
- 좋은 단위 테스트 작성하는 것 중요
- 단위 테스트의 목표는 소프트웨어 프로젝트가 지속적으로 성장하게 하는 것
- 테스트 스위트 내에 가치 있는 테스트만 남기고 나머지 모두 제거해야 함
- 커버리지가 낮다는 것은 문제 징후지만, 커버리지가 높다고 테스트 스위트의 품질 높은 것 아님
- 특정 커버리지 숫자를 부과하면 동기 부여가 잘못된 것
- 성공적인 테스트 스위트 특성
    - 개발 주기에 통합돼 있다.
    - 코드베이스 중 가장 중요한 부분만을 대상으로 한다.
    - 최소하느이 유지비로 최대의 가치를 끌어낸다.
- 단위 테스트의 목표 달성을 위한 방법
    - 좋은 테스트와 좋지 않은 테스트 구별하는 방법 배우기
    - 테스트 리팩터링 해 가치있는 테스트 만들기
