# 3장. 시스템 설계 면접 공략법

> 시스템 설계 면접
- 두 명의 동료가 모호한 문제를 풀기 위해 협력하여 그 해결책을 찾아내느 과정에 대한 시뮬레이션
> 
- 설계 능력의 기술적 측면을 평가하는 것이 아닌, 협력에 접합한 사람인지!
    - 과도한 엔지니어링.. X

## 효과적 면접을 위한 4단계 접근법

### [ 1단계 - 문제 이해 및 설계 범위 확정 ]

> TODO : 요구사항을 이해하고 모호함을 없애기
> 
- 요구사항을 완전히 이해하지 않고 답을 내놓는 행위는 부정적 신호
- 엔지니어가 가져야할 중요한 기술
    - 올바른 질문을 하는것
    - 적절한 가정을 하는 것
    - 시스템 구축에 필요한 정보를 모은 것
- 요구사항을 정확히 이해하는 데 필요한 질문 필요
    
    ```
    😃 구체적으로 어떤 기능들을 만들어야 하나?
    😃 제품 사용자 수는 얼마나 되나?
    😃 회사의 규모는 얼마나 빨리 커지리라 예상하나?
    😃 회사가 주로 사용하는 기술 스택은 무엇인가?
    😃 설계를 단순화하기 위해 활용할 수 있는 기존 서비스로는 어떤 것들이 있는가?
    ```
    

### [ 2단계 - 개략적인 설계안 제시 및 동의 구하기 ]

> TODO : 개략적인 설계안을 제시하고 면접관의 동의 얻기
> 
- 설계안에 대한 최초 청사진을 제시하고 의견을 구하라.
- 핵심 컴포넌트를 포함하는 다이어그램을 그려라.
- 최초 설계안이 시스템 규모에 관계된 제약사항들을 만족하는지를 개략적으로 개산해 보라.
- 시스템의 구체적 사용 사례도 몇 가지 살펴보자.

### [ 3단계 - 상세 설계 ]

```
✔ 시스템에서 전반적으로 달성해야 할 목표와 기능 범위 확인
✔ 전체 설계의 개략적 청사진 마련
✔ 해당 청사진에 대한 면접관의 의견 청취
✔ 상세 설계에서 집중해야 할 영역들 확인
```

> TODO : 설계 대상 컴포넌트 사이의 우선순위를 정하는 것
> 
- 면접관 : 지원자가 특정 시스템 컴포넌트들의 세부사항을 깊이 있게 설명하는 것 원함
    - 단축 URL 생성기 - 해시 함수의 설계 구체적으로…
    - 채팅 시스템 - 지연시간을 줄이고, 사용자의 온/오프 상태 표시 하는 법 구체적으로..
- 불필요한 세부사항에 시간을 쓰지 말고, 규모 확장 가능한 시스템을 설계할 능력이 있다는 것 입증하자!

### [ 4단계 - 마무리 ]

> TODO : 후속 질문 대비 및 스스로 추가 논의 진행
> 
- 면접관이 시스템 병목 구간, 더 개선 가능한 지점 후속 질문 가능
    
    → 개선할 점은 언제나 있으니, 개선할 것 없다고 말하지 말자.
    
- 스스로 추가 논의 진행하기
    
    ```
    - 설계를 한 번 다시 요약해주기.
    - 오류 발생 시 무슨 일 발생하는지 따져보기.
    - 운영 이슈 논의하기.
    - 규모 확장 요구에 어떻게 대처할 것인지.
    - 세부적 개선사항들 제안하기.
    ```
    

### [ 면접 세션 정리 ]

- 해야 할 것
    
    ```
    ✔ 질문을 통해 확인하라.
    	> 스스로 내린 가정이 옳다고 믿고 진행하지 마라.
    ✔ 문제의 요구사항을 이해하라.
    ✔ 정답이나 최선의 답안 같은 것은 없다는 점을 명심하라.
    ✔ 면접관이 여러분의 사고흐름을 이해할 수 있도록 하라.
    ✔ 가능하다면 여러 해법을 함께 제시하라.
    ✔ 개략적 설계에 면접관이 동의하면, 각 컴포넌트의 세부사항을 설명하기 시작하라.
    	> 가장 중요한 컴포넌트부터 진행하라.
    ✔ 면접관의 아이디어를 이끌어 내라.
    ✔ 포기하지 말라.
    ```
    
- 하지 말아야 할 것
    
    ```
    ❌ 전형적인 면접 문제들에도 대비하지 않은 상태에서 면접장에 가지 말라.
    ❌ 요구사항이나 가정들을 분명히 하지 않은 상태에서 설계를 제시하지 말라.
    ❌ 처음부터 특정 컴포넌트의 세부사항을 너무 깊이 설명하지 말라.
    ❌ 진행 중에 막혔다면, 힌트를 청하기를 주저하지 말라.
    ❌ 소통을 주저하지 말라.
    ❌ 의견을 일찍, 그리고 자주 구하라.
    ❌ 면접관이 끝났다고 해야 끝난것이다.
    ```
    

### [ 시간 배분 ]

- 1단계 - 문제 이해 및 설계 범위 확정 : `3분 ~ 10분`
- 2단계 - 개략적 설계안 제시 및 동의 구하기 : `10분 ~ 15분`
- 3단계 - 상세 설계 : `10분 ~ 25분`
- 4단계 - 마무리 : `3분 ~ 5분`

## 뉴스 피스 시스템 설계 예제

### [ 1단계 - 문제 이해 및 설계 범위 확정 ]

> TODO : 요구사항을 이해하고 모호함을 없애기
> 

![Untitled](img/hongeunbeen/1.png)

- 모바일 앱, 웹 앱 둘다 지원해야 함
- 새로운 포스트 올리고, 다른 친구의 뉴스 피드 보는 기능
- 포스트는 시간 역순으로 정렬됨
- 한 사용자는 5000명까지 친구 맺을 수 있음
- 트래픽 규모는 일간 능동사용자 천만 명임
- 이미지나 비디오 같은 미디어 파일도 포스트 가능

### [ 2단계 - 개략적인 설계안 제시 및 동의 구하기 ]

> TODO : 개략적인 설계안을 제시하고 면접관의 동의 얻기
> 
- 두가지 flow 존재
    - 피드 발행
        - 사용자 : 소프트 올리면 관련된 데이터가 캐시/데이터베이스에 기록
        - 사용자의 친구 : 뉴스 피드에 해당 포스터 뜸
    - 피드 생성
        - 사용자의 뉴스 피드 : 친구들의 소프트를 시간 역순으로 정렬해 만듬
- **피드 발행**
    
    ![Untitled](img/hongeunbeen/2.png)
    
- **피드 생성**
    
    ![Untitled](img/hongeunbeen/3.png)
    

### [ 3단계 - 상세 설계 ]

```
✔ 시스템에서 전반적으로 달성해야 할 목표와 기능 범위 확인
✔ 전체 설계의 개략적 청사진 마련
✔ 해당 청사진에 대한 면접관의 의견 청취
✔ 상세 설계에서 집중해야 할 영역들 확인
```

> TODO : 설계 대상 컴포넌트 사이의 우선순위를 정하는 것
> 
1. **피드 발행**
    
    ![Untitled](img/hongeunbeen/4.png)
    
    1. 그래프 데이터베이스에서 친구 id 목록 추천
    2. 사용자 정보 캐시에서 친구 데이터 추출 (캐시 없다면 데이터베이스에서)
    3. 메시지 큐로 데이터 무손실 지원 (비동기적) 받으면서 포스팅 전송 작업 서버로 데이터 전송
    4. 뉴스 피드는 DB없이 캐시에만 저장함
2. **뉴스 피드 가져오기**
    
    ![Untitled](img/hongeunbeen/5.png)
    
    1. 사용자 로드밸런서 Public IP로 접속
    2. 로드 밸런서 Private IP로 서버 접속
    3. 뉴스 피드 캐시 가져옴 (중요한 데이터 먼저 가져옴)
    4. 포스팅, 사용자 정보 캐시 가져옴

### [ 4단계 - 마무리 ]

> TODO : 후속 질문 대비 및 스스로 추가 논의 진행
> 

```
❓ 설계 요약
🗨 웹앱, 앱으로 접근 가능한 서비스로 크게 피드 발행, 피드 가져오기로 설계 나눔
로드 밸런서를 통해 서버에 접속 후 웹 서버의 인증과 처리율 제한을 거쳐 각 서비스 접근
모든 데이터베이스를 거치기 전 캐시서버를 두어 자주 사용하는 데이터는 빠르게 처리함
포스팅 전송 서비스에서는 메시지 큐를 사용해 데이터 무손실을 보장하고, 
친구 피드에 빠르게 나올 수 있게 뉴스 피드 캐시를 따로 두어 해당 캐시에 넣음

❓ 개선할 점
🗨 이미지, 동영상 등 미디어 파일을 청크해 업로드하면 더 빠르고 안전하게 포스팅 가능할듯
🗨 포스팅 저장 서비스와 전송 서비스 사이의 데이터 일관성이 걱정됨

❓ 규모 확장 요구
🗨 로드벨런서를 사용해 웹 서버의 스케일 아웃 가능
```