# 메시지와 인터페이스

객체지향 프로그래밍의 가장 중요한 재료는 클래스가 아니라 객체들이 주고받는 메시지다.

## 협력과 메시지

### 클라이언트 - 서버 모델

협력은 어떤 객체가 다른 객체에게 메시지를 통해 무언가를 요청할 때 시작된다.

* 클라이언트: 메시지를 전송하는 객체
* 서버: 메시지를 수신하는 객체

객체가 독립적으로 수행할 수 있는 것보다 더 큰 책임을 수행하기 위해서는 다른 객체와 협력해야 한다.

### 메시지와 메시지 전송

* 메시지: 객체들이 협력하기 위해 사용할 수 있는 유일한 의사소통 수단. 오퍼레이션명과 인자로 구성된다.
* 메시지 전송: 한 객체가 다른 객체에게 도움을 요청하는 것
* 메시지 전송자: 메시지를 전송하는 객체
* 메시지 수신자: 메시지를 수신하는 객체

### 메시지와 메서드

* 메서드: 메시지를 수신했을 때 실제로 실행되는 함수 또는 프로시저

메시지 전송자와 메시지 수신자는 서로에 대해 상세한 정보를 알지 못한 채 메시지라는 끈을 통해서만 연결된다.

실행 시점에 메시지와 메서드를 바인딩하는 메커니즘은 두 객체 사이의 결합도를 낮춘다.

### 퍼블릭 인터페이스와 오퍼레이션

* 퍼블릭 인터페이스: 객체가 의사소통을 위해 외부에 공개하는 메시지의 집합
* 오퍼레이션: ^ 에 포함된 메시지. (실행하기 위해 객체가 호출될 수 있는 변환이나 정의에 관한 명세)

### 시그니처

* 시그니처: 오퍼레이션이나 메서드의 명세를 나타낸 것으로 이름과 인자의 목록을 포함한다.

# 인터페이스와 설계 품질

좋은 인터페이스는 최소한, 추상적 -> 이 두 조건을 만족해야 한다.
가장 좋은 방법은 RDD이다.

퍼블릭 인터페이스의 품질에 영향을 미치는 원칙과 기법 종류:
* 디미터 법칙
* 묻지 말고 시켜라
* 의도를 드러내는 인터페이스
* 명령-쿼리 분리

## 디미터 법칙

객체의 내부 구조에 강하게 결합되지 않도록 협력 경로를 제한하라. 캡슐화를 다른 의미로 표현한 것.

즉, 객체가 자기 자신을 책임지는 자율적인 존재여야 한다. (연쇄적인 ‘기차 충돌’ 피하기)

## 묻지 말고 시켜라

객체의 상태에 대해 묻지 말고 원하는 것을 시켜라 -> 자연스럽게 정보와 행동을 동일한 클래스 안에 두게 된다. -> 높은 응집도를 가질 확률이 높아짐

## 의도를 드러내는 인터페이스

인터페이스는 객체가 어떻게 하는지를이 아닌 무엇을 하는지를 서술해야 함.

의도를 드러내는 선택자를 인터페이스 레벨로 확장하자 객체에게 묻지 말고 시키되 구현 방법이 아닌 클라이언트의 의도를 드러내야 한다.

## 원칙의 함정

### 디미터 법칙은 하나의 도트를 강제하는 규칙이 아니다.

```
IntStream.of(1, 15, 20, 3, 9).filter(x -> x > 10).distinct().count()
```

단순히 기차 충돌을 많이 초래한다고 해서 디미터 법칙을 위반하는 것은 아님 -> 객체의 내부 구조가 외부로 노출되는 경우에만 한정됨

### 결합도와 응집도의 충돌

묻지말고 시켜라 법칙과 디미터 법칙을 무작정 따르다가 응집도가 낮은 객체로만 넘쳐날 수도 있다. 즉, 객체가 상관 없는 책임들을 떠맡을 수도 있다.

객체에게 시키는 것이 항상 가능한 것은 아니다. 가끔씩은 원칙을 맹신하지 말고 물어야 한다.

## 명령 - 쿼리 분리 원칙

* 루틴: 어떤 절차를 묶어 호출 가능하도록 이름을 부여한 기능 모듈
  * 루틴에서 분리 -> 프로시저(명령): 부수효과를 발생시킬 수 있지만 값을 반환할 수 없다
  * 루틴에서 분리 -> 함수(쿼리): 값을 반환할 수 있지만 부수효과를 발생시킬 수 없음

명령과 쿼리를 분리하기 위해서는 다음을 지켜야 한다
* 객체의 상태를 변경하는 명령은 반환값을 가질 수 없다
* 객체의 정보를 반환하는 쿼리는 상태를 변경할 수 없다

즉, 질문이 답변을 수정해서는 안된다.

### 참조 투명성

* 참조 투명성: 어떤 표현식 e가 있을 때 e의 값으로 e가 나타나는 모든 위치를 교체하더라도 결과가 달라지지 않는다
  * 모든 함수를 이미 알고 있는 하나의 결과값으로 대체할 수 있으므로 식을 쉽게 계산할 수 있다
  * 모든 곳에서 함수의 결과값이 공일하기 때문에 식의 순서를 변경하더라도 각 식의 결과는 달라지지 않는다
* 불변성: 어떤 값이 변하지 않는 성질. 부수효과가 발생하지 않는다

### 명령형과 함수형 프로그래밍의 차이

* 명령형: 부수 효과를 기반으로 작성하는 프로그래밍 방식
* 함수형: 부수 효과가 존재하지 않는 수학적인 함수에 기반

### 책임에 초점을 맞춰라

훌륭한 메시지를 얻기 위한 출발점은 RDD를 따르는 것이다. 협력에 적합한 객체(X), 협력에 적합한 메시지(O)

계약에 의한 설계: 협력을 위해 클라와 서버가 준수해야 하는 제약을 코드 상에 명시적으로 표현하고 강제할 수 있는 방법
