# 11. 합성과 유연한 설계



상속과 합성

- 상속 :  부모 클래스와 자식 클래스를 연결해서 부모 클래스의 코드를 재사용
- 합성 : 전체를 표현하는 객체가 부분을 표현하는 객체를 포함해서 부분 객체의 코드를 재사용



의존성

상속 - 컴파일 타임에 의해 해결되고 **is - a** 라 부른다.

합성 - 런타임에 해결되며 **has -a** 라 부른다.



관계

- 상속 - 클래스 사이의 정적인 관계
- 합성 - 객체 사이의 동적인 관계



재사용의 대상

- 상속 - 부모클래스 안에 구현된 코드 자체
- 합성 - 포함되는 객체의 퍼블릭 인터페이스



#### 상속의 문제점

불필요한 인터페이스 상속 문제

- 자식 클래스에 부적합한 부모 클래스의 오퍼레이션이 상속되기 때문에 자식 클래스의 인스턴스의 상태가 불안정해지는 문제.

메서드 오버리이딩의 오작용 문제

- 부모 클래스와 자식 클래스의 메서드를 오버라이딩 할 때 자식 클래스가 부모 클래스의 메서드 호출 방법에 영행을 받는 문제

부모 클래스와 자식 클래스의 동시 수정 문제

- 부모 클래스와 자식 클래스 사이의 개념적인 결합으로 인해 부모 클래스를 변경할 떄 자식 클래스도 함께 변경해야 하는 문제



합성을 사용하면 위의 문제를 해결할수 있다.



#### 불필요한 인터페이스 상속  문제



상속관계를 제외하고 Properties의 인스턴스 변수로 포함시키면  더이상 인터페이스를 오염시키지 않는다.



#### 메서드 오버라이딩의 오작용 문제



A 인스턴스를 내부에 포함한 후 A의 퍼블릭 인터페이스에서 제공하는 오퍼레이션들을 이용해 필요한 기능을 구현



포워딩 : 오버라이딩한 인스턴스 메서드에서 내부 인스턴스에게 동일한 메서드 호출을 하는 것

포워딩 메서드 : 동일한 메서드를 호출하기 위해 추가된 메서드



#### 부모 클래스와 자식 클래스의 동시 수정 문제

- 몽키 패치 : 현재 실행 중인 환경에만 영향을 미치도록 지역적으로 코드를 수정하거나 확장하는 것을 가리킨다.



## 02. 상속으로 인한 조합의 폭발적인 증가



상속으로 인해 결합도가 높아지면 문제점

- 하나의 기늠을 추가하거나 수정하기 위해 불필요하게 많은 수의 클래스를 추가하거나 수정해야 한다.
- 단일 상속만 지원하는 언어에서는 상속으로 인해 오히려 중복 코드의 양이 늘어날 수 있다.



#### 기본 정책과 부가 정책 조합하기 ~ 기본 정책에 기본 요금 할인 정책 조합하기

추상 메서드와 훅 메서드

- 훅 메서드 :  추상 메서드와 동일하게 자식 클래스에서 오버라이딩 할 의도로 메서드를 추가했지만 편의를 위해 기본 구현을 제공하는 메서드



#### 중복 코드의 덫에 걸리다



클래스 폭발/ 조합의 폭발  : 상속의 남용으로 하나의 기능을 추가하기 위해 필요 이상으로 많은 수의 클래스를 추가 해야 하는 경우

-> 문제를 해결 : 최선의 방법은 상속을 포기하는 것



## 03. 합성 관계로 변경하기



합성은 런타임에 동적으로 변경을 할수 있는데 이를 통해 컴파일 의존성과 런타임 의존성을 다르게 만들어서 클래스 폭발의 문제를 해결할수 있다.

컴파일타임 의존성과 런타임 의존성이 거리가 멀면 설계가 상승해 어려워 지지만  변경에 고통이 복잡성으로 인한 혼란을 넘어서고 있따면 유연성의 손을 들어주는것이 맞다.



#### 객체 합성이 클래스 상속보다 더 좋은 방법이다

객체지향에서 코드를 재사용하기 위해 가장 널리 사용되는 방법은 상속이다.

클래스를 강하게 결합 시키기 떄문에 코드의 진화를 방해한다.

상속이 구현을 재사용하는 데 비해 합성은 객체의 인터페이스를 재사용한다.



## 04. 믹스인



**믹스인** : 객체를 생성할 때 코드 일부를 클래스 안에 섞어 넣어 재사용하는 기법을 가리키는 용어

합성이 실행 시점에 객체를 조합하는 재사용 방법이라면 믹스인은 컴파일 시점에 필요한 코드조각을 조합하는 재사용 방법



트레이트 조합 : 믹스인 하려는 대상 클래스의 부모 클래스가 존재하는 경우 부모 클래스는 extends를 이용해 상속받고 트레이트는 with를 이용해 믹스인해야 하는 것

메서드 실행 순서

- 스칼라는 특정 클래스에 믹스인한 클래스와 트레이트를 선형화 해서 어떤 메서드를 호출할지 결정한다.
- 클래스의 인스턴스를 생성할 때 스칼라는 클래스 자신과 조상 클래스, 트레이트를 일렬로 나열해서 순서를 정한다.
- 메서드 내부에서 super호출
- 클레스나 트레이트의 메서드가 호출



쌓을 수 있는 변경 : 스인을 사용해 특정한 클래스에 대한 변경 또는 확장을 독립적으로 구현한 후 필요한 시점에 차례대로 추가하는 것





> 코드 설명이 많은 파트라 굉장히 적은 양이다. 책을 10장부터는 책을 보면서 하는것을 추천한다. 나는 코드 없이 간략한 부분으로 볼수있게 만드는게 목적이기때문에 코드를 제외했다.

