# 코루틴 인 액션

## 안드로이드 스튜디오 설치

https://developer.android.com/studio/install?hl=ko

## 안드로이드의 UI 스레드

안드로이드에서는 뷰 작업을 헨들링하는 UI 스레드가 존재하고 UI 스레드가 아닌 곳에서 뷰 작업이 발생하면 `CalledFromWrongThreadException`를 던진다.

## 코루틴 디스패처

코루틴을 시작하거나 재개할 스레드를 결정하기 위해 코루틴 디스패처가 사용된다. 모든 코루틴 디스패처는 CoroutineDispatcher인터페이스를 구현해야 한다.

* DefaultDispatcher
* CommonPool: 공유 백그라운드 스레드 풀에서 코루틴을 실행하고 재개한다. 기본 크기로 인해 CPU 바운드 작업에서 사용하기에 최적이다.
* Unconfined: 현재 스레드(코루틴이 호출된 스레드)에서 코루틴을 시작하지만 모든 스레드에서 코루틴을 재개한다. 이 디스패처는 스레드 정책을 사용하지 않는다.

이러한 디스패처와 함께 필요에 따라 풀 또는 스레드를 정의하는 데에 사용할 수 있는 빌더가 몇 가지 있다.

* newSingleThreadContext(): 단일 스레드로 디스패처를 빌드한다. 여기에서 실행되는 코루틴은 항상 같은 스레드에서 시작되고 재개된다.
* newFixedThreadPoolContext(): 주어진 크기의 스레드 풀로 디스패처를 만든다. 런타임은 디스패처에서 실행되는 코루틴을 시작하고 재개할 때 사용할 스레드를 결정한다.

## 
코루틴 빌더
코루틴 빌더는 일시 중단된 람다를 가져와 코루틴을 생성하여 실행하는 함수이다. Kotlin은 다음과 같은 다양한 일반적인 시나리오에 맞게 조정되는 많은 코루틴 빌더를 제공한다.

* async(): 결과가 예상될 때 코루틴을 시작하는 데 사용된다. 코루틴 내부에서 발생하는 모든 예외를 캡처하여 결과에 저장 하므로 주의해서 사용해야 한다. 
* Deferred<T>: 결과 또는 예외를 포함하여 리턴
* launch(): 결과를 반환하지 않는 코루틴을 시작한다. Job실행 또는 자식 실행을 취소하는 데 사용할 수 있다.
* runBlocking(): 코루틴 실행이 완료될 때까지 현재 스레드를 차단한다.

## 요약

* UI 스레드에서 네트워크 요청이 수행되면 Android 응용 프로그램이 NetworkOnMainThreadException을 발생시킨다.
* 안드로이드 응용 프로그램은 UI 스레드에서만 UI를 업데이트할 수 있으며 다른 스레드에서 UI를 업데이트하려고 하면 CallingFromWrongThreadException이 발생한다.
* 네트워크 요청은 백그라운드 스레드에서 수행되어야 한다. 보기를 업데이트하려면 UI 스레드로 정보가 전송되어야 한다.
* CoroutineDispatcher는 코루틴이 특정 스레드 또는 스레드 그룹에서 실행되도록 강제하는 데 사용될 수 있다.
* 하나 이상의 코루틴은 실행 또는 비동기 방식을 사용하여 스레드에서 실행할 수 있다.
* 코틀린은 안드로이드, 스윙, 자바FX 등을 위한 특정 라이브러리를 가지고 있다. 각각은 UI 요소를 업데이트하기 위한 적절한 코루틴 디스패처를 제공한다.
* 동시성 코드를 작성하는 방법에는 여러 가지가 있는데, 코틀린의 유연성을 최대한 활용하면서도 명시적이고 안전하며 일관되게 만드는 방법을 이해하는 것이 중요하다.