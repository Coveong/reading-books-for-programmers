# 09장. 리스코프 치환 원칙

> 여기에서 필요한 것은 다음과 같은 치환 원틱이다. S 타입의 객체 o1 각각에 대응하는 T 타입 객체 o2가 있고, T 타입을 이용해서 정의한 모든 프로그램 P에서 o2의 자리에 o1을 치환하더라도 P의 행위가 변한지 않는다면, S는 T의 하위 타입이다.
- 바바라 리스코프 (하위 타입 정의)

위 글은 리스코프 치환 원칙으로 알려진 개념입니다.

리스코프 치환 원칙의 개념을 이해하기 위해 몇 가지 예제를 보겠습니다.

# 리스코프 치환 원칙 예제

## 1. 상속을 사용하도록 가이드하기

![09%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%85%E1%85%B5%E1%84%89%E1%85%B3%E1%84%8F%E1%85%A9%E1%84%91%E1%85%B3%20%E1%84%8E%E1%85%B5%E1%84%92%E1%85%AA%E1%86%AB%20%E1%84%8B%E1%85%AF%E1%86%AB%E1%84%8E%E1%85%B5%E1%86%A8%20d53ab827ae5c4df998ec6a5cd6a3901d/IMG_EE18E19D672C-1.jpeg](09%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%85%E1%85%B5%E1%84%89%E1%85%B3%E1%84%8F%E1%85%A9%E1%84%91%E1%85%B3%20%E1%84%8E%E1%85%B5%E1%84%92%E1%85%AA%E1%86%AB%20%E1%84%8B%E1%85%AF%E1%86%AB%E1%84%8E%E1%85%B5%E1%86%A8%20d53ab827ae5c4df998ec6a5cd6a3901d/IMG_EE18E19D672C-1.jpeg)

위 설계는 LSP를 준수합니다.

`Billing` 애플리케이션의 행위가 `License`하위 타입 중 무엇을 사용하는지에 전혀 의존하지 않기 때문입니다.

## 2. 정사각형/직사각형

![09%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%85%E1%85%B5%E1%84%89%E1%85%B3%E1%84%8F%E1%85%A9%E1%84%91%E1%85%B3%20%E1%84%8E%E1%85%B5%E1%84%92%E1%85%AA%E1%86%AB%20%E1%84%8B%E1%85%AF%E1%86%AB%E1%84%8E%E1%85%B5%E1%86%A8%20d53ab827ae5c4df998ec6a5cd6a3901d/IMG_A707B634CD7D-1.jpeg](09%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%85%E1%85%B5%E1%84%89%E1%85%B3%E1%84%8F%E1%85%A9%E1%84%91%E1%85%B3%20%E1%84%8E%E1%85%B5%E1%84%92%E1%85%AA%E1%86%AB%20%E1%84%8B%E1%85%AF%E1%86%AB%E1%84%8E%E1%85%B5%E1%86%A8%20d53ab827ae5c4df998ec6a5cd6a3901d/IMG_A707B634CD7D-1.jpeg)

위 설계는 LSP를 위반합니다.

```java
Rectangle r = ...
r.setW(5);
r.setH(2);
assert(r.area() == 10);
```

`Square`의 높이와 너비는 함께 변경되지만 `Rectangle`은 따로 변경이 가능하기에 혼동이 생길 수 있습니다.

# LSP와 아키텍처

LSP 객체 지향 초창기 : 상속을 사용하도록 가이드하는 방법

LSP 현재 : 인터페이스와 구현제에도 적용되는 더 광범위한 소프트웨어 설계 원칙

→ 여기서 인터페이스란?

- 자바스러운 언어 : 인터페이스 하나와 이를 구현하는 여러 개의 클래스
- 루비 언어 : 동일한 메서드 시그니처를 공유하는 여러 개의 클래스
- 동일한 REST 인터페이스에 응답하는 서비스 집단

잘 정의된 인터페이스와 그 인터페이스 구현체끼리의 상호 치환 가능성에 기대는 사용자들이 존재합니다.

🤔그럼, 이 원칙을 어겼을 때 어떻게 되나요?

# LSP 위배 사례

다양한 택시 파견 서비스를 통합하는 애플리케이션이 있습니다.

```
purplecab.com/dirver/Bob
						 /pickupAddress/24 Maple St.
						 /pickupTime/153
						 /destination/ORD
```

REST 서비스의 URL에 파견에 필요한 정보를 덧붙인 후 PUT방식으로 호출합니다.

그럼, 만약 어느 업체에서 `destination` 을 `dest`로 요약해서 REST 서비스 URL을 변경한다면 이런 예외를 처리하는 코드가 추가되어야 합니다.

```java
if (driver.getDispatchUrl()).startsWith("acme.com"))...
```

아키텍트는 REST 서비스들의 인터페이스가 서로 치환 가능하지 않다는 사실을 처리하는 중요하고 복잡한 메커니즘을 추가해야 합니다.

# 결론

치환 가능성을 조금이라도 위배하면 시스템 아키텍처가 오염되어 별도 메커니즘을 추가해야 할수 있기에 **LSP는 아키텍처 수준까지 확장할 수 있고, 반드시 확장**해야 합니다.