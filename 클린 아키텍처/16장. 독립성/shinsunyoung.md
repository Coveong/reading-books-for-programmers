# 16장. 독립성

좋은 아키텍처는 다음을 지원해야 한다.

- 시스템의 유스케이스
- 시스템의 운영
- 시스템의 개발
- 시스템의 배포

# 유스케이스

시스템의 아키텍처는 시스템의 의도를 지원해야 한다.

(예를 들어 시스템이 장바구니 애플리케이션이라면, 이 아키텍처는 장바구니와 관련된 유스케이스를 지원해야 한다.)

좋은 아키텍처가 행위를 지원하기 위해 할 수 있는 일 중에서 가장 중요한 사항은 행위를 명확히 하고 외부로 드러내며, 이를 통해 시스템이 지닌 의도를 아키텍처 수준에서 알아볼 수 있게 만드는 것이다.

# 운영

시스템의 운영 지원 고나점에서 볼 때 아키텍처는 더 실질적이고 덜 피상적인 역할을 맡는다.

아키텍처에서 각 컴포넌트를 적절히 격리하여 유지하고 컴포넌트 간 통신 방식을 특정 형태로 제한하지 않는다면, 시간이 지나 운영에 필요한 요구사항이 바뀌더라도 스레드, 프로세스, 서비스로 구성된 기술 스펙트럼 사이를 전환하는 일이 훨씬 쉬워질 것이다. (모놀리틱보다 MSA가 나은 이유!)

# 개발

아키텍처는 개발환경을 지원하는 데 있어 핵심적인 역할을 수행한다.

콘웨이의 법칙이 작용하는 지점

> 시스템을 설계하는 조직이라면 어디든지 그 조직의 의사소통 구조와 동일한 구조의 설계를 만들어 낼 것이다.

각 팀이 독립적으로 행동하기 편한 아키텍처를 확보하는 것이 중요하다. 왜냐하면 그렇게 하면 서로 방해하지 않기 때문이다.

# 배포

아키텍처는 배포 용이성을 결정하는 데 중요한 역할을 한다.

좋은 아키텍처는 시스템이 빌드된 후 즉각 배포할 수 있도록 지원해야 한다.

# 선택사항 열어놓기

좋은 아키텍처는 선택사항을 열어 둠으로써, 향후 시스템에 변경이 필요할 때 어떤 방향으로든 쉽게 변경할 수 있도록 한다.

# 계층 결합 분리

아키텍트는 단일 책임 원칙과 공통 폐쇄 원칙을 적용하여 그 의도의 맥락에 따라서 다른 이유로 변경되는 것들을 분리하고, 동일한 이유로 변경되는 것들은 묶는다.

# 유스케이스 결합 분리

유스케이스는 시스템을 분할하는 매우 자연스러운 방법이다.

유스케이스는 시스템의 수평적인 계층을 가로지르도록 자른, 수직으로 좁다란 조각이기도 하다. 각 유스케이스는 UI의 일부, 애플리케이션 특화 업무 규칙의 일부, 애플리케이션 독립적 업무 규칙의 일부, 그리고 데이터베이스 기능의 일부를 사용한다. → 따라서 우리는 시스템을 수평적 계층으로 분할하면서 동시에 해당 계층을 가로지르는 얇은 수직적인 유스케이스로 시스템을 분할할 수 있다.

# 결합 분리 모드

유스케이스를 위해 수행하는 작업들(결합 분리)은 운영에도 도움이 된다.

서비스에 기반한 아키텍처를 흔히 **서비스 지향 아키텍처(serice-oriented-architecture, SOA)**라고 부른다. (ex. 마이크로 서비스(micro-serice))

좋은 아키텍처는 선택권을 열어 둔다. 결합 분리 모드는 이러한 선택지 중 하나다.

# 개발 독립성

컴포넌트가 완전히 분리되면 팀 사이의 간섭은 줄어든다.

기능 팀, 컴포넌트 팀, 계층 팀, 혹은 또 다른 형태의 팀이라도, 계층과 유스케이스의 결합이 분리되는 한 시스템의 아키텍처는 그 팀 구조를 뒷받침해줄 것이다.

# 배포 독립성

유스케이스와 계층의 결합이 분리되면 배포 측면에서도 고도의 유연성이 생긴다.

→ 실제로 결합을 제대로 분리했다면 운영 중인 시스템에서도 계층과 유스케이스를 교체(hot-swap)할 수 있다.

# 중복

소프트웨어에서 중복은 일반적으로 나쁘지만, 중복에도 여러 종류가 있다.

- 진짜 중복
    - 은 없애야한다.
- 거짓된, 또는 우발적인 중복
    - 두 코드가 각자의 경로로 발전한다면, 즉 서로 다른 속도와 다른 이유로 변경된다면 가짜 중복이다.
    - 얘는 없앨 필요 없다.

# 결합 분리 모드(다시)

계층-유스케이스의 결합을 분리하는 방법?

- 소스 코드 수준
    - 모든 컴포넌트가 같은 주소 공간에서 실행되고, 서로 통신할 때 간단한 함수 호출 사용
    - **모놀리틱 구조라고도 함**
- 바이너리 코드(배포) 수준
    - 배포 가능한 단위(jar, DDL ...)들 사이의 의존성 제어 가능
- 실행 단위(서비스) 수준
    - 네트워크 패킷을 통해서만 통신 가능
    - 완전히 독립적
    - **마이크로 서비스라고도 함**

뭐가 제일 좋을까?

- 현 시점에서 가장 인기 있어보이는 모드는 서비스 수준 분리 모드이다. 이를 기본 정책으로 삼는다면?
    - 비용이 많이 들고 결합이 큰 단위에서 분리된다는 문제가 있다.
    - 시스템 자원 측면에서도 비용이 많이 든다.
- 컴포넌트가 서비스화 될 가능성이 있다면 컴포넌트 결합을 분리하되 서비스가 되기 직전에 멈추는 방식 선호
- **좋은 아키텍처는 모노리틱 구조로 시작해 마이크로서비스 수준까지 성장해도 원래 형태로 돌아갈 수 있어햐 한다.**

# 결론

시스템의 결합 분리 모드는 시간이 지나면서 바뀌기 쉬우며, 뛰어난 아키텍트라면 이러한 변경을 예측하여 큰 무리 없이 반영할 수 있도록 만들어야 한다.